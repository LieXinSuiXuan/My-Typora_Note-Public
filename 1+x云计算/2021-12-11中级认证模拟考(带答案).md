[toc]



# 1+X云计算平台运维与开发职业技能认证考试



## 2021年12月11日下午中级模拟

试卷说明：本试卷共*20道单选题，15道多选题，18道实操题，* 满分1000分。

考试时间：2021-12-11 14:00-18:00

### 【单选题】 题型说明：该题型共20题，每题10分

#### 1、当Leader崩溃或者Leader失去大多数的Follower，这时候ZooKeeper会进行什么操作？(            )

A、恢复模式
B、修复模式
C、重新启动下面那个不是cinder服务的组件？
D、停机模式

#### 2、以下关于云计算安全性描述中，正确的是？(            )

A、无法查询云平台登陆记录
B、无法审计云资源的使用率
C、尽管云计算提供各项安全服务，但是我们仍然需要注意备份
D、云安全保障了我们不会受到来自管理员的操作失误影响

#### 3、下面哪个公司是OpenShift的开发公司？(            )

A、谷歌
B、红帽
C、亚马逊
D、微软

#### 4、在mdadm管理RAID阵列的动作当中，Assemble的作用是什么？(            )

A、创建一个新的阵列，每个设备具有超级块
B、创建一个没有超级块的阵列
C、监控状态
D、将设备加入到以前定义的阵列

#### 5、下列选项当中，哪个不属于数据库的性能优化？(            )

A、系统内核优化
B、硬件配置
C、数据库配置优化
D、软件配置

#### 6、下面哪个不是Linux操作系统的优点？(            )

A、适合Inter等X86CPU系列的计算机
B、与Unix系统不兼容
C、Linux是开放源代码的程序软件，可以自由修改
D、可自由传播，无任何商业版权限制

#### 7、关于腾讯云关系型数据库CDB的产品优势，下列说法不正确的是？(            )

A、用户可根据业务情况选择精确到秒粒度的按量计费模式，或者价格更优惠的包年包月模式。
B、默认支持双主备份模式
C、提供多种存储介质选型，可根据业务情况灵活选择。
D、仅需几步可轻松完成数据库从部署到访问，不需要预先准备基础设施，也不需要安装和维护数据库软件。

#### 8、下列哪项服务不属于云计算服务解决方案？(            )

A、提供海量低成本的存储服务
B、降低固定资产折旧速度
C、提供高并发业务能力
D、给用户画像，精准营销

#### 9、以下关于Swift系统中Account、Container、Object三者之间的关系正确的是？(            )

A、一个Account可以创建拥有任意多个Object，一个Object中可以包含任意多个Container。
B、一个Container可以创建拥有任意多个Account，一个Account中可以包含任意多个Object。
C、一个Account可以创建拥有任意多个Container，一个Container中可以包含任意多个Object。
D、一个Object可以创建拥有任意多个Container，一个Container中可以包含任意多个Account。

#### 10、路由选择是哪一层的功能？(            )

A、网络层
B、数据链路层
C、传输层
D、应用层

#### 11、关于VPC，下列描述错误的是？(            )

A、由于公有云多租户的特点，用户不可以自主划分网段
B、默认两个私有网络之间无法提供连接功能
C、VPC是一块逻辑隔离网络空间
D、其余皆为错误

#### 12、在K8S的核心组件中负责维护集群状态的组件是？(            )

A、scheduler
B、controllermanage
C、kubelet
D、etcd

#### 13、Master将改变记录到二进制日志（binarylog）中，这些记录叫做？(            )

A、语句修改记录
B、二进制修改记录
C、日志修改记录
D、二进制日志事件

#### 14、使一台IP地址为10.0.0.1的主机访问Internet的必要技术是？(            )

A、静态路由
B、NAT
C、动态路由
D、路由引入

#### 15、项目计划阶段不包括？(            )

A、里程碑和基线时间设定
B、一份项目工作任务书
C、人员安排
D、风险预测

#### 16、192.168.0.0/24使用掩码255.255.255.240划分子网，其可用子网数为多少？每个子网内可用主机地址数为多少？(            )

A、1462
B、1416
C、25414
D、1614

#### 17、软件会逐渐退化而不会磨损，其原因在于？(            )

A、软件通常暴露在恶劣的环境下
B、软件错误在经常使用之后会逐渐增加
C、不断的变更使组件接口之间引起错误
D、软件备件很难订购

#### 18、以下哪种无线协议数据传播速率最快(            )

A、802.11a
B、802.11g
C、802.11ac
D、802.11n

#### 19、Zabbix允许用户为几乎任何事件配置基于_____________的告警？(            )

A、短信
B、邮件
C、日志
D、本地文件

#### 20、OpenStack的组件不包括？(            )

A、EC2
B、Nova
C、Swift
D、Keystone



### 【多选题】题型说明：该题型共15题，每题20分



#### 21、弹性伸缩的应用场景有哪些？(            )

A、自动替换不健康CVM
B、提高服务器性能
C、低成本应对业务浪涌
D、提前部署扩容缩容

#### 22、Swift采用的是REST架构，REST架构遵循了CRUD原则，CRUD原则对于资源需要以下哪些行为？(            )

A、Create（创建）
B、Delete（删除）
C、Read（读取）
D、Update（更新）

#### 23、以下哪些命令可以获取linux主机的负载相关指标？(            )

A、uptime
B、top
C、sar
D、ls

#### 24、传统银行在业务上不断创新，进行转型升级的要求有？(            )

A、集群监控
B、IT基础设施
C、日志收集
D、应用架构

#### 25、在Linux系统下，你用vi编辑器对文本文件test.txt进行了修改，想保存对该文件所做的修改并正常退出vi编辑器，可以使用下面哪些方法？(            )

A、在命令模式下执行ZZ命令
B、在末行模式下执行:wq
C、在命令模式下执行WQ命令
D、在末行模式下执行:q!

#### 26、属于无线AP的安全措施的是？(            )

A、启用WEP
B、启用MAC地址过滤
C、隐藏SSID
D、启用DHCP服务

#### 27、Nginx支持哪些常用模块？(            )

A、rewrite
B、vhosts
C、proxy
D、ssh

#### 28、Keystone的主要操作包括？(            )

A、绑定权限
B、创建用户
C、创建项目
D、创建角色

#### 29、端口聚合的方式有哪些？(            )

A、自动聚合
B、静态聚合
C、动态聚合
D、手工聚合

#### 30、下列选项中哪些是RAID磁盘阵列的好处？(            )

A、较高的性能价格比
B、极强的容错能力，保证了数据的安全
C、教大的存储量，保证了海量数据的存储
D、较佳的I/O传输率，有效的匹配了CPU、内存的速度

#### 31、Nginx可以作为以下哪些服务使用？(            )

A、作为安全防护
B、作为负载均衡
C、作为邮件服务器
D、作为服务器

#### 32、软件开发工具是协助开发人员进行软件开发活动所使用的软件或环境。下面是软件开发的工具是？(            )

A、维护工具
B、测试工具
C、需求分析
D、编码工具

#### 33、以下哪个是核心Kubernetes对象？(            )

A、Pods
B、Volumes
C、Services
D、ReplicaSet

#### 34、腾讯云VPC提供了灵活、高性能的Internet连接方式包括下列哪些方法？(            )

A、NAT网关
B、VPN通道
C、弹性IP
D、对端网关

#### 35、在计算机局域网中，常用通信设备有？(            )

A、调制解调器
B、集线器
C、路由器
D、交换机



### 【实操题】 题型说明：该题型共18题，共500分

#### 36、网络管理

配置R1和R2路由器（路由器使用AR2220），R1路由器配置端口g0/0/1地址为192.168.1.1/30，端口g0/0/1连接R2路由器。配置端口g0/0/2地址为192.168.2.1/24，作为内部PC1机网关地址。R2路由器配置端口g0/0/1地址为192.168.1.2/30，端口g0/0/1连接R1路由器，配置端口g0/0/2地址为192.168.3.1/24，作为内部PC2机网关地址。R1和R2路由器启用OSPF动态路由协议自动学习路由。使PC1和PC2可以相互访问。（所有配置命令使用完整命令，使用Tab键补齐）(20)分

~~~powershell
[Huawei]interface GigabitEthernet 0/0/1
[Huawei-GigabitEthernet0/0/1]ip address 192.168.1.1 30
[Huawei-GigabitEthernet0/0/1]quit
[Huawei]interface GigabitEthernet 0/0/2
[Huawei-GigabitEthernet0/0/2]ip address 192.168.2.1 24
[Huawei-GigabitEthernet0/0/2]quit
[Huawei]ospf 1
[Huawei-ospf-1]area 0
[Huawei-ospf-1-area-0.0.0.0]network 192.168.1.0 0.0.0.3
[Huawei-ospf-1-area-0.0.0.0]network 192.168.2.0 0.0.0.255
[Huawei]interface GigabitEthernet 0/0/1
[Huawei-GigabitEthernet0/0/1]ip address 192.168.1.2 30
[Huawei-GigabitEthernet0/0/1]quit
[Huawei]interface GigabitEthernet 0/0/2
[Huawei-GigabitEthernet0/0/2]ip address 192.168.3.1 24
[Huawei-GigabitEthernet0/0/2]quit
[Huawei]ospf 1
[Huawei-ospf-1]area 0
[Huawei-ospf-1-area-0.0.0.0]network 192.168.1.0 0.0.0.3
[Huawei-ospf-1-area-0.0.0.0]network 192.168.3.0 0.0.0.255
~~~



#### 37、网络管理

使用eNSP进行实验，配置防火墙（防火墙型号使用USG5500）g0/0/2端口添加至trust域，g0/0/1端口添加至untrust域。配置trust域到untrust域规则，放行内部地址172.16.105.0/24网段。配置NAT规则，匹配内部地址172.16.105.0/24网段，使用g0/0/1端口的地址进行转换。（所有配置命令使用完整命令，使用Tab键补齐）(30)分

~~~powershell
[SRG]firewall zone trust
[SRG-zone-trust]add interface GigabitEthernet 0/0/2
[SRG-zone-trust]quit
[SRG]firewall zone untrust
[SRG-zone-untrust]add interface GigabitEthernet 0/0/1
[SRG-zone-untrust]quit
[SRG]policy interzone trust untrust outbound
[SRG-policy-interzone-trust-untrust-outbound]policy 0
[SRG-policy-interzone-trust-untrust-outbound-0]action permit
[SRG-policy-interzone-trust-untrust-outbound-0]policy source 172.16.105.0 mask 24 
[SRG-policy-interzone-trust-untrust-outbound-0]quit
[SRG-policy-interzone-trust-untrust-outbound]quit
[SRG]nat-policy interzone trust untrust outbound
[SRG-nat-policy-interzone-trust-untrust-outbound]policy 1
[SRG-nat-policy-interzone-trust-untrust-outbound-1]action source-nat
[SRG-nat-policy-interzone-trust-untrust-outbound-1]policy source 172.16.105.0 0.255.255.255
[SRG-nat-policy-interzone-trust-untrust-outbound-1]easy-ip GigabitEthernet 0/0/1
~~~





#### 38、YUM源管理

使用提供的xnode1节点，自行确认IP地址并连接。该节点的/root目录下有一个CentOS-7-x86_64-DVD-1511.iso的镜像文件，使用这个镜像文件配置本地yum源，要求将这个镜像文件挂载在/opt/centos目录，请问如何配置自己的local.repo文件，使得可以使用该镜像中的软件包，安装软件。请将local.repo文件的内容和执行yum repolist的返回结果以文本形式提交到答题框。(20)分

~~~powershell
[root@xnode1 ~]# mkdir /opt/centos
[root@xnode1 ~]# mount CentOS-7-x86_64-DVD-1511.iso /opt/centos
mount: /dev/loop0 is write-protected, mounting read-only
[root@xnode1 ~]# cd /etc/yum.repos.d/
[root@xnode1 yum.repos.d]# rm -f *
[root@xnode1 yum.repos.d]# vi local.repo
[centos]
name=cdrom
baseurl=file:///opt/centos
gpgcheck=0
enable=1
[root@xnode1 yum.repos.d]# yum repolist
Loaded plugins: fastestmirror
centos                                                                                                                                            | 3.6 kB  00:00:00     
(1/2): centos/group_gz                                                                                                                            | 155 kB  00:00:00     
(2/2): centos/primary_db                                                                                                                          | 2.8 MB  00:00:00     
Determining fastest mirrors
repo id                                                                           repo name                                                                        status
centos                                                                            cdrom                                                                            3,723
repolist: 3,723
~~~



#### 39、KVM管理

使用xnode1节点，完成KVM服务的安装与KVM虚拟机的启动（安装KVM组件使用CentOS-7-x86_64-DVD-1511.iso镜像源）。安装完毕后，使用提供的cirros镜像与qemu-ifup-NAT脚本启动虚拟机（命令为qemu-kvm -m 1024 -drive file=xxx.img,if=virtio -net nic,model=virtio -net tap,script=xxx -nographic -vnc :1）。启动完毕后将登录界面从#####debug end######那行开始至最后的内容以文本形式提交到答题框。(20)分

~~~powershell
[root@xnode1 ~]# yum install qemu-kvm openssl libvirt net-tools -y		//net-tools中的ifconfig工具在最后启动kvm虚拟机时需要用到
..................................
[root@xnode1 ~]# systemctl start libvirtd
[root@xnode1 ~]# ln -s /usr/libexec/qemu-kvm /usr/bin/qemu-kvm
[root@xnode1 ~]# chmod +x /root/qemu-ifup-NAT
[root@xnode1 ~]# qemu-kvm -m 1024 -drive file=/root/cirros-0.3.4-x86_64-disk.img,if=virtio -net nic,model=virtio -net tap,script=/root/qemu-ifup-NAT -nographic -vnc :1
..............................

=== network info ===
if-info: lo,up,127.0.0.1,8,::1
if-info: eth0,up,192.168.122.89,24,fe80::5054:ff:fe12:3456
ip-route:default via 192.168.122.1 dev eth0 
ip-route:192.168.122.0/24 dev eth0  src 192.168.122.89 
=== datasource: None None ===
=== cirros: current=0.3.4 uptime=46.52 ===
  ____               ____  ____
 / __/ __ ____ ____ / __ \/ __/
/ /__ / // __// __// /_/ /\ \ 
\___//_//_/  /_/   \____/___/ 
   http://cirros-cloud.net


login as 'cirros' user. default password: 'cubswin:)'. use 'sudo' for root.
cirros login: cirros
Password: 
$ ip addr list
1: lo: <LOOPBACK,UP,LOWER_UP> mtu 16436 qdisc noqueue 
    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00
    inet 127.0.0.1/8 scope host lo
    inet6 ::1/128 scope host 
       valid_lft forever preferred_lft forever
2: eth0: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc pfifo_fast qlen 1000
    link/ether 52:54:00:12:34:56 brd ff:ff:ff:ff:ff:ff
    inet 192.168.122.89/24 brd 192.168.122.255 scope global eth0				//看到192.168.122.89的IP地址即证明正确
    inet6 fe80::5054:ff:fe12:3456/64 scope link 
       valid_lft forever preferred_lft forever
$ route -n
Kernel IP routing table
Destination     Gateway         Genmask         Flags Metric Ref    Use Iface
0.0.0.0         192.168.122.1   0.0.0.0         UG    0      0        0 eth0
192.168.122.0   0.0.0.0         255.255.255.0   U     0      0        0 eth0
$ sudo halt													//此命令为关闭kvm虚拟机，然后SecureCRT断开连接后再重新连接即可继续后面实验
The system is going down NOW!
Sent SIGTERM to all processes
Sent SIGKILL to all processes
Requesting system halt
[   60.908223] System halted.
~~~





#### 40、Raid存储管理

使用xnode1节点，使用vmware给xnode1节点添加一块大小为20G的硬盘。使用fdisk命令对该硬盘进形分区，要求分出4个大小为5G的分区。使用这4个分区，创建名为/dev/md5、raid级别为5的磁盘阵列加一个热备盘。创建完成后执行mdadm -D /dev/md5，将创建Raid、查看Raid信息的命令和返回结果以文本形式提交到答题框。(30)分

~~~powershell
//先在VMware系统中为xnode1添加一块20G的硬盘，然后将xnode1虚拟机重启。虚拟机重启完毕之后，再使用SecureCRT重新连接

[root@xnode1 ~]# lsblk
NAME            MAJ:MIN RM  SIZE RO TYPE MOUNTPOINT
sda               8:0    0   50G  0 disk 
├─sda1            8:1    0  500M  0 part /boot
└─sda2            8:2    0 49.5G  0 part 
  ├─centos-root 253:0    0 47.5G  0 lvm  /
  └─centos-swap 253:1    0    2G  0 lvm  [SWAP]
sdb               8:16   0   20G  0 disk 				//重启之后确认有20G的sdb存在
sr0              11:0    1 1024M  0 rom  
[root@xnode1 ~]# fdisk /dev/sdb
Welcome to fdisk (util-linux 2.23.2).

Changes will remain in memory only, until you decide to write them.
Be careful before using the write command.

Device does not contain a recognized partition table
Building a new DOS disklabel with disk identifier 0xacf700d0.

Command (m for help): n						//新建4个主分区，分区号为1-4，起始扇区为默认，结束扇区输入+5G，第4个分区特殊，结束扇区直接回车
Partition type:
   p   primary (0 primary, 0 extended, 4 free)
   e   extended
Select (default p): p						//p为新建主分区
Partition number (1-4, default 1): 1		//分区号为1
First sector (2048-41943039, default 2048): 		//起始扇区为默认，直接回车
Using default value 2048
Last sector, +sectors or +size{K,M,G} (2048-41943039, default 41943039): +5G		//结束扇区输入+5G
Partition 1 of type Linux and of size 5 GiB is set

Command (m for help): n
Partition type:
   p   primary (1 primary, 0 extended, 3 free)
   e   extended
Select (default p): p
Partition number (2-4, default 2): 2
First sector (10487808-41943039, default 10487808): 
Using default value 10487808
Last sector, +sectors or +size{K,M,G} (10487808-41943039, default 41943039): +5G
Partition 2 of type Linux and of size 5 GiB is set

Command (m for help): n
Partition type:
   p   primary (2 primary, 0 extended, 2 free)
   e   extended
Select (default p): p
Partition number (3,4, default 3): 3
First sector (20973568-41943039, default 20973568): 
Using default value 20973568
Last sector, +sectors or +size{K,M,G} (20973568-41943039, default 41943039): +5G
Partition 3 of type Linux and of size 5 GiB is set

Command (m for help): n
Partition type:
   p   primary (3 primary, 0 extended, 1 free)
   e   extended
Select (default e): p
Selected partition 4
First sector (31459328-41943039, default 31459328): 
Using default value 31459328
Last sector, +sectors or +size{K,M,G} (31459328-41943039, default 41943039): +5G		//第4个分区输入+5G会提示空间不足
Value out of range.
Last sector, +sectors or +size{K,M,G} (31459328-41943039, default 41943039): 			//此处需要直接回车
Using default value 41943039
Partition 4 of type Linux and of size 5 GiB is set

Command (m for help): p										//p为显示分区表

Disk /dev/sdb: 21.5 GB, 21474836480 bytes, 41943040 sectors
Units = sectors of 1 * 512 = 512 bytes
Sector size (logical/physical): 512 bytes / 512 bytes
I/O size (minimum/optimal): 512 bytes / 512 bytes
Disk label type: dos
Disk identifier: 0xacf700d0

   Device Boot      Start         End      Blocks   Id  System
/dev/sdb1            2048    10487807     5242880   83  Linux
/dev/sdb2        10487808    20973567     5242880   83  Linux
/dev/sdb3        20973568    31459327     5242880   83  Linux
/dev/sdb4        31459328    41943039     5241856   83  Linux

Command (m for help): t										//输入t将4个分区的分区类型修改为fd，即'Linux raid autodetect'Partition number (1-4, default 4): 1
Hex code (type L to list all codes): fd
Changed type of partition 'Linux' to 'Linux raid autodetect'

Command (m for help): t
Partition number (1-4, default 4): 2
Hex code (type L to list all codes): fd
Changed type of partition 'Linux' to 'Linux raid autodetect'

Command (m for help): t
Partition number (1-4, default 4): 3
Hex code (type L to list all codes): fd
Changed type of partition 'Linux' to 'Linux raid autodetect'

Command (m for help): t
Partition number (1-4, default 4): 4
Hex code (type L to list all codes): fd
Changed type of partition 'Linux' to 'Linux raid autodetect'

Command (m for help): w								//w存盘退出
The partition table has been altered!

Calling ioctl() to re-read partition table.
Syncing disks.

[root@xnode1 ~]# mount CentOS-7-x86_64-DVD-1511.iso /opt/centos		//重启之后需要重新挂载光驱，计算机重启之后mount的挂载会丢失
[root@xnode1 ~]# yum install -y mdadm								//安装mdadm
Loaded plugins: fastestmirror
Loading mirror speeds from cached hostfile
Resolving Dependencies
--> Running transaction check
---> Package mdadm.x86_64 0:3.3.2-7.el7 will be installed
--> Processing Dependency: libreport-filesystem for package: mdadm-3.3.2-7.el7.x86_64
--> Running transaction check
---> Package libreport-filesystem.x86_64 0:2.1.11-32.el7.centos will be installed
--> Finished Dependency Resolution

Dependencies Resolved

=========================================================================================================================================================================
 Package                                        Arch                             Version                                          Repository                        Size
=========================================================================================================================================================================
Installing:
 mdadm                                          x86_64                           3.3.2-7.el7                                      centos                           393 k
Installing for dependencies:
 libreport-filesystem                           x86_64                           2.1.11-32.el7.centos                             centos                            37 k

Transaction Summary
=========================================================================================================================================================================
Install  1 Package (+1 Dependent package)

Total download size: 430 k
Installed size: 928 k
Downloading packages:
-------------------------------------------------------------------------------------------------------------------------------------------------------------------------
Total                                                                                                                                     16 MB/s | 430 kB  00:00:00     
Running transaction check
Running transaction test
Transaction test succeeded
Running transaction
  Installing : libreport-filesystem-2.1.11-32.el7.centos.x86_64                                                                                                      1/2 
  Installing : mdadm-3.3.2-7.el7.x86_64                                                                                                                              2/2 
  Verifying  : mdadm-3.3.2-7.el7.x86_64                                                                                                                              1/2 
  Verifying  : libreport-filesystem-2.1.11-32.el7.centos.x86_64                                                                                                      2/2 

Installed:
  mdadm.x86_64 0:3.3.2-7.el7                                                                                                                                             

Dependency Installed:
  libreport-filesystem.x86_64 0:2.1.11-32.el7.centos                                                                                                                     

Complete!

[root@xnode1 ~]# mdadm -C /dev/md5 -l 5 -n 3 -x 1 /dev/sdb1 /dev/sdb2 /dev/sdb3 /dev/sdb4 
mdadm: Defaulting to version 1.2 metadata
mdadm: array /dev/md5 started.

[root@xnode1 ~]# mdadm -D /dev/md5
/dev/md5:
        Version : 1.2
  Creation Time : Sun Dec 12 11:40:42 2021
     Raid Level : raid5
     Array Size : 10475520 (9.99 GiB 10.73 GB)
  Used Dev Size : 5237760 (5.00 GiB 5.36 GB)
   Raid Devices : 3
  Total Devices : 4
    Persistence : Superblock is persistent

    Update Time : Sun Dec 12 11:41:08 2021
          State : clean 
 Active Devices : 3
Working Devices : 4
 Failed Devices : 0
  Spare Devices : 1

         Layout : left-symmetric
     Chunk Size : 512K

           Name : xnode1:5  (local to host xnode1)
           UUID : 2be5ba56:acee7d3c:5744f68a:43e22253
         Events : 18

    Number   Major   Minor   RaidDevice State
       0       8       17        0      active sync   /dev/sdb1
       1       8       18        1      active sync   /dev/sdb2
       4       8       19        2      active sync   /dev/sdb3

       3       8       20        -      spare   /dev/sdb4
~~~





#### 41、Zookeeper集群

继续使用上题的三台虚拟机，使用提供的zookeeper-3.4.14.tar软件包，完成Zookeeper集群的安装与配置，配置完成后，在三个节点相应的目录使用./zkServer.sh status命令查看三个Zookeeper节点的状态，将三个节点的状态以文本形式提交到答题框。(30)分

~~~powershell
[root@mycat ~]# zookeeper-3.4.14/bin/zkServer.sh status
ZooKeeper JMX enabled by default
Using config: /root/zookeeper-3.4.14/bin/../conf/zoo.cfg
Mode: follower
[root@db1 ~]# zookeeper-3.4.14/bin/zkServer.sh status
ZooKeeper JMX enabled by default
Using config: /root/zookeeper-3.4.14/bin/../conf/zoo.cfg
Mode: leader
[root@db2 ~]# zookeeper-3.4.14/bin/zkServer.sh status
ZooKeeper JMX enabled by default
Using config: /root/zookeeper-3.4.14/bin/../conf/zoo.cfg
Mode: follower
~~~





#### 42、Kafka集群

继续使用上题的三台虚拟机，使用提供软件包，完成Kafka集群的安装与配置，配置完成后，查看三个节点Kafka的端口启动情况并在相应的目录使用./kafka-topics.sh --create --zookeeper 你的IP:2181 --replication-factor 1 --partitions 1 --topic test创建topic，将查看Kafka端口启动情况和创建topic命令的返回结果以文本形式提交到答题框。(30)分

~~~powershell
[root@mycat ~]# netstat -ntpl
Active Internet connections (only servers)
Proto Recv-Q Send-Q Local Address           Foreign Address         State       PID/Program name    
tcp        0      0 0.0.0.0:22              0.0.0.0:*               LISTEN      1468/sshd           
tcp        0      0 127.0.0.1:25            0.0.0.0:*               LISTEN      1910/master         
tcp        0      0 127.0.0.1:32000         0.0.0.0:*               LISTEN      3854/java           
tcp6       0      0 :::49320                :::*                    LISTEN      3854/java           
tcp6       0      0 :::9066                 :::*                    LISTEN      3854/java           
tcp6       0      0 :::36144                :::*                    LISTEN      4301/java           
tcp6       0      0 192.168.200.11:3888     :::*                    LISTEN      3954/java           
tcp6       0      0 :::38576                :::*                    LISTEN      3854/java           
tcp6       0      0 :::21                   :::*                    LISTEN      2877/vsftpd         
tcp6       0      0 :::22                   :::*                    LISTEN      1468/sshd           
tcp6       0      0 ::1:25                  :::*                    LISTEN      1910/master         
tcp6       0      0 :::35613                :::*                    LISTEN      3954/java           
tcp6       0      0 :::1984                 :::*                    LISTEN      3854/java           
tcp6       0      0 :::8066                 :::*                    LISTEN      3854/java           
tcp6       0      0 192.168.200.11:9092     :::*                    LISTEN      4301/java           
tcp6       0      0 :::2181                 :::*                    LISTEN      3954/java           

[root@db1 ~]# netstat -ntpl
Active Internet connections (only servers)
Proto Recv-Q Send-Q Local Address           Foreign Address         State       PID/Program name    
tcp        0      0 0.0.0.0:22              0.0.0.0:*               LISTEN      1460/sshd           
tcp        0      0 127.0.0.1:25            0.0.0.0:*               LISTEN      1760/master         
tcp6       0      0 192.168.200.12:2888     :::*                    LISTEN      13088/java          
tcp6       0      0 :::3306                 :::*                    LISTEN      3354/mysqld         
tcp6       0      0 :::36268                :::*                    LISTEN      13441/java          
tcp6       0      0 192.168.200.12:3888     :::*                    LISTEN      13088/java          
tcp6       0      0 :::22                   :::*                    LISTEN      1460/sshd           
tcp6       0      0 :::44793                :::*                    LISTEN      13088/java          
tcp6       0      0 ::1:25                  :::*                    LISTEN      1760/master         
tcp6       0      0 :::9092                 :::*                    LISTEN      13441/java          
tcp6       0      0 :::2181                 :::*                    LISTEN      13088/java  

[root@db2 ~]# netstat -ntpl
Active Internet connections (only servers)
Proto Recv-Q Send-Q Local Address           Foreign Address         State       PID/Program name    
tcp        0      0 0.0.0.0:22              0.0.0.0:*               LISTEN      1457/sshd           
tcp        0      0 127.0.0.1:25            0.0.0.0:*               LISTEN      1754/master         
tcp6       0      0 :::3306                 :::*                    LISTEN      3238/mysqld         
tcp6       0      0 192.168.200.13:3888     :::*                    LISTEN      6560/java           
tcp6       0      0 :::36656                :::*                    LISTEN      6560/java           
tcp6       0      0 :::22                   :::*                    LISTEN      1457/sshd           
tcp6       0      0 ::1:25                  :::*                    LISTEN      1754/master         
tcp6       0      0 :::34234                :::*                    LISTEN      6908/java           
tcp6       0      0 192.168.200.13:9092     :::*                    LISTEN      6908/java           
tcp6       0      0 :::2181                 :::*                    LISTEN      6560/java       

[root@mycat ~]# kafka_2.11-1.1.1/bin/kafka-topics.sh --create --zookeeper 192.168.200.11:2181 --replication-factor 1 --partitions 1 --topic test
Created topic "test".

[root@db1 ~]# kafka_2.11-1.1.1/bin/kafka-topics.sh --list --zookeeper 192.168.200.12:2181
OpenJDK 64-Bit Server VM warning: If the number of processors is expected to increase from one, then you should configure the number of parallel GC threads appropriately using -XX:ParallelGCThreads=N
test

[root@db2 ~]# kafka_2.11-1.1.1/bin/kafka-topics.sh --list --zookeeper 192.168.200.13:2181
OpenJDK 64-Bit Server VM warning: If the number of processors is expected to increase from one, then you should configure the number of parallel GC threads appropriately using -XX:ParallelGCThreads=N
test
~~~





#### 43、主从数据库管理

使用xnode2、xnode3虚拟机进行实验，在这两台虚拟机上安装mariadb数据库服务，并配置为主从数据库（xnode2为主节点、xnode3为从节点，安装数据库使用CentOS-7-x86_64-DVD-1511.iso和gpmall-repo这两个源），实现两个数据库的主从同步。配置完毕后，请在xnode3上的数据库中执行“show slave status \G”命令查询从节点复制状态，将查询到的结果以文本形式提交到答题框。(30)分

~~~powershell
MariaDB [(none)]> show slave status\G;
*************************** 1. row ***************************
                Slave_IO_State: Waiting for master to send event
                   Master_Host: db1
                   Master_User: user
                   Master_Port: 3306
                 Connect_Retry: 60
               Master_Log_File: mysql-bin.000001
           Read_Master_Log_Pos: 701
                Relay_Log_File: db2-relay-bin.000002
                 Relay_Log_Pos: 1000
         Relay_Master_Log_File: mysql-bin.000001
              Slave_IO_Running: Yes
             Slave_SQL_Running: Yes
               Replicate_Do_DB: 
           Replicate_Ignore_DB: 
            Replicate_Do_Table: 
        Replicate_Ignore_Table: 
       Replicate_Wild_Do_Table: 
   Replicate_Wild_Ignore_Table: 
                    Last_Errno: 0
                    Last_Error: 
                  Skip_Counter: 0
           Exec_Master_Log_Pos: 701
               Relay_Log_Space: 1307
               Until_Condition: None
                Until_Log_File: 
                 Until_Log_Pos: 0
            Master_SSL_Allowed: No
            Master_SSL_CA_File: 
            Master_SSL_CA_Path: 
               Master_SSL_Cert: 
             Master_SSL_Cipher: 
                Master_SSL_Key: 
         Seconds_Behind_Master: 0
 Master_SSL_Verify_Server_Cert: No
                 Last_IO_Errno: 0
                 Last_IO_Error: 
                Last_SQL_Errno: 0
                Last_SQL_Error: 
   Replicate_Ignore_Server_Ids: 
              Master_Server_Id: 12
                Master_SSL_Crl: 
            Master_SSL_Crlpath: 
                    Using_Gtid: No
                   Gtid_IO_Pos: 
       Replicate_Do_Domain_Ids: 
   Replicate_Ignore_Domain_Ids: 
                 Parallel_Mode: conservative
                     SQL_Delay: 0
           SQL_Remaining_Delay: NULL
       Slave_SQL_Running_State: Slave has read all relay log; waiting for the slave I/O thread to update it
              Slave_DDL_Groups: 2
Slave_Non_Transactional_Groups: 0
    Slave_Transactional_Groups: 0
1 row in set (0.000 sec)
~~~





#### 44、读写分离数据库管理

使用xnode1，xnode2，xnode3三个节点，完成数据库读写分离实验（安装数据库使用CentOS-7-x86_64-DVD-1511.iso和gpmall-repo这两个源）。数据库中间件使用Mycat-server-1.6-RELEASE-20161028204710-linux.tar。完成Mycat读写分离数据库的配置安装。需要用的配置文件schema.xml文件如下所示（server.xml文件不再给出）：

~~~powershell
<?xml version="1.0"?>
<!DOCTYPE mycat:schema SYSTEM "schema.dtd">
<mycat:schema xmlns:mycat="http://io.mycat/">

        <schema name="USERDB" checkSQLschema="true" sqlMaxLimit="100" dataNode="dn1"></schema>
        <dataNode name="dn1" dataHost="localhost1" database="test" />
        <dataHost name="localhost1" maxCon="1000" minCon="10" balance="0" writeType="0" dbType="mysql" dbDriver="native" switchType="1"  slaveThreshold="100">
                <heartbeat>select user()</heartbeat>
                <writeHost host="hostM1" url="172.16.51.18:3306" user="root" password="123456">
                        <readHost host="hostS1" url="172.16.51.30:3306" user="root" password="123456" />
                </writeHost>
        </dataHost>
</mycat:schema>
~~~

配置读写分离数据库完毕后：1）使用netstat -ntpl命令查询端口启动情况；2）登陆mycat，查询数据库。将上述两个操作的操作命令返回结果以文本形式提交到答题框。(30)分

~~~powershell
[root@mycat ~]# netstat -ntpl
Active Internet connections (only servers)
Proto Recv-Q Send-Q Local Address           Foreign Address         State       PID/Program name    
tcp        0      0 0.0.0.0:22              0.0.0.0:*               LISTEN      1468/sshd           
tcp        0      0 127.0.0.1:25            0.0.0.0:*               LISTEN      1910/master         
tcp        0      0 127.0.0.1:32000         0.0.0.0:*               LISTEN      3854/java           
tcp6       0      0 :::49320                :::*                    LISTEN      3854/java           
tcp6       0      0 :::9066                 :::*                    LISTEN      3854/java           
tcp6       0      0 :::38576                :::*                    LISTEN      3854/java           
tcp6       0      0 :::21                   :::*                    LISTEN      2877/vsftpd         
tcp6       0      0 :::22                   :::*                    LISTEN      1468/sshd           
tcp6       0      0 ::1:25                  :::*                    LISTEN      1910/master         
tcp6       0      0 :::1984                 :::*                    LISTEN      3854/java           
tcp6       0      0 :::8066                 :::*                    LISTEN      3854/java           

[root@mycat ~]# mysql -h127.0.0.1 -P9066 -uroot -p123456 -e 'show @@datasource;'
+----------+--------+-------+----------------+------+------+--------+------+------+---------+-----------+------------+
| DATANODE | NAME   | TYPE  | HOST           | PORT | W/R  | ACTIVE | IDLE | SIZE | EXECUTE | READ_LOAD | WRITE_LOAD |
+----------+--------+-------+----------------+------+------+--------+------+------+---------+-----------+------------+
| dn1      | hostM1 | mysql | 192.168.200.12 | 3306 | W    |      0 |    0 | 1000 |       0 |         0 |          0 |
| dn1      | hostS1 | mysql | 192.168.200.13 | 3306 | R    |      0 |    0 | 1000 |       0 |         0 |          0 |
+----------+--------+-------+----------------+------+------+--------+------+------+---------+-----------+------------+
~~~





#### 45、应用商城系统

继续使用上题的三台虚拟机，使用提供的软件包，基于集群应用系统部署。部署完成后，进行登录，（订单中填写的收货地址填写自己学校的地址，收货人填写自己的实际联系方式）最后使用curl命令去获取商城首页的返回信息，将curl http://你自己的商城IP/#/home获取到的结果以文本形式提交到答题框。(30)分

~~~powershell
[root@mycat ~]# curl http://192.168.200.11/#/home
<!DOCTYPE html><html><head><meta charset=utf-8><title>1+x-示例项目</title><meta name=keywords content=""><meta name=description content=""><meta http-equiv=X-UA-Compatible content="IE=Edge"><meta name=wap-font-scale content=no><link rel="shortcut icon " type=images/x-icon href=/static/images/favicon.ico><link href=/static/css/app.8d4edd335a61c46bf5b6a63444cd855a.css rel=stylesheet></head><body><div id=app></div><script type=text/javascript src=/static/js/manifest.2d17a82764acff8145be.js></script><script type=text/javascript src=/static/js/vendor.4f07d3a235c8a7cd4efe.js></script><script type=text/javascript src=/static/js/app.81180cbb92541cdf912f.js></script></body></html><style>body{
        min-width:1250px;
  }</style>
~~~



#### openstack排错

若在openstack使用过程中出现报错的情况，请先使用openstack-status命令检查openstack各个组件状态。

~~~powershell
[root@controller ~]# source /etc/keystone/admin-openrc.sh				//加载openstack管理员权限，每次SecureCRT连接都需要运行此命令
[root@controller ~]# glance image-create --name "cirros" --disk-format qcow2 --container-format bare --progress < cirros-0.3.4-x86_64-disk.img 
Unable to establish connection to http://controller:35357/v3/auth/tokens		//此处为运维时的报错信息
[root@controller ~]# openstack-status
== Nova services ==
openstack-nova-api:                     active
openstack-nova-compute:                 active
openstack-nova-network:                 inactive  (disabled on boot)
openstack-nova-scheduler:               active
openstack-nova-conductor:               active
openstack-nova-console:                 inactive  (disabled on boot)
openstack-nova-consoleauth:             active
openstack-nova-xvpvncproxy:             inactive  (disabled on boot)
== Glance services ==
openstack-glance-api:                   active
openstack-glance-registry:              active
== Keystone service ==
openstack-keystone:                     inactive  (disabled on boot)
== Horizon service ==
openstack-dashboard:                    uncontactable						//此处为错误，dashboard为web仪表板，所以需要重启httpd服务
== neutron services ==
neutron-server:                         failed								//此处为错误，需要重启neutron-server服务
neutron-dhcp-agent:                     active
neutron-l3-agent:                       active
neutron-metadata-agent:                 active
neutron-lbaas-agent:                    active
neutron-lbaasv2-agent:                  inactive  (disabled on boot)
neutron-openvswitch-agent:              active
neutron-linuxbridge-agent:              inactive  (disabled on boot)
== Swift services ==
openstack-swift-proxy:                  active
openstack-swift-account:                active
openstack-swift-container:              active
openstack-swift-object:                 active
== Cinder services ==
openstack-cinder-api:                   active
openstack-cinder-scheduler:             active
openstack-cinder-volume:                active
openstack-cinder-backup:                inactive  (disabled on boot)
== Ceilometer services ==
openstack-ceilometer-api:               active
openstack-ceilometer-central:           active
openstack-ceilometer-compute:           active
openstack-ceilometer-collector:         active
openstack-ceilometer-notification:      active
== Heat services ==
openstack-heat-api:                     active
openstack-heat-api-cfn:                 active
openstack-heat-api-cloudwatch:          inactive  (disabled on boot)
openstack-heat-engine:                  active
== Support services ==
mariadb:                                active
openvswitch:                            active
dbus:                                   active
target:                                 active
rabbitmq-server:                        active
memcached:                              active
== Keystone users ==
/usr/lib/python2.7/site-packages/keystoneclient/shell.py:64: DeprecationWarning: The keystone CLI is deprecated in favor of python-openstackclient. For a Python library, continue using python-keystoneclient.
  'python-keystoneclient.', DeprecationWarning)
WARNING: unsupported identity-api-version 3, falling back to 2.0
/usr/lib/python2.7/site-packages/keystoneclient/v2_0/client.py:145: DeprecationWarning: Constructing an instance of the keystoneclient.v2_0.client.Client class without a session is deprecated as of the 1.7.0 release and may be removed in the 2.0.0 release.
  'the 2.0.0 release.', DeprecationWarning)
/usr/lib/python2.7/site-packages/keystoneclient/v2_0/client.py:147: DeprecationWarning: Using the 'tenant_name' argument is deprecated in version '1.7.0' and will be removed in version '2.0.0', please use the 'project_name' argument instead
  super(Client, self).__init__(**kwargs)
/usr/lib/python2.7/site-packages/debtcollector/renames.py:45: DeprecationWarning: Using the 'tenant_id' argument is deprecated in version '1.7.0' and will be removed in version '2.0.0', please use the 'project_id' argument instead
  return f(*args, **kwargs)
/usr/lib/python2.7/site-packages/keystoneclient/httpclient.py:371: DeprecationWarning: Constructing an HTTPClient instance without using a session is deprecated as of the 1.7.0 release and may be removed in the 2.0.0 release.
  'the 2.0.0 release.', DeprecationWarning)
/usr/lib/python2.7/site-packages/keystoneclient/session.py:140: DeprecationWarning: keystoneclient.session.Session is deprecated as of the 2.1.0 release in favor of keystoneauth1.session.Session. It will be removed in future releases.
  DeprecationWarning)
/usr/lib/python2.7/site-packages/keystoneclient/auth/identity/base.py:56: DeprecationWarning: keystoneclient auth plugins are deprecated as of the 2.1.0 release in favor of keystoneauth1 plugins. They will be removed in future releases.
  'in future releases.', DeprecationWarning)
Authorization Failed: Unable to establish connection to http://controller:35357/v3/tokens
== Glance images ==
Unable to establish connection to http://controller:35357/v3/auth/tokens
== Nova managed services ==
No handlers could be found for logger "keystoneauth.identity.generic.base"
ERROR (ConnectFailure): Unable to establish connection to http://controller:35357/v3/auth/tokens
== Nova networks ==
No handlers could be found for logger "keystoneauth.identity.generic.base"
ERROR (ConnectFailure): Unable to establish connection to http://controller:35357/v3/auth/tokens
== Nova instance flavors ==
No handlers could be found for logger "keystoneauth.identity.generic.base"
ERROR (ConnectFailure): Unable to establish connection to http://controller:35357/v3/auth/tokens
== Nova instances ==
No handlers could be found for logger "keystoneauth.identity.generic.base"
ERROR (ConnectFailure): Unable to establish connection to http://controller:35357/v3/auth/tokens

[root@controller ~]# systemctl restart httpd
[root@controller ~]# systemctl restart neutron-server

[root@controller ~]# openstack-status                
== Nova services ==
openstack-nova-api:                     active
openstack-nova-compute:                 active
openstack-nova-network:                 inactive  (disabled on boot)
openstack-nova-scheduler:               active
openstack-nova-conductor:               active
openstack-nova-console:                 inactive  (disabled on boot)
openstack-nova-consoleauth:             active
openstack-nova-xvpvncproxy:             inactive  (disabled on boot)
== Glance services ==
openstack-glance-api:                   active
openstack-glance-registry:              active
== Keystone service ==
openstack-keystone:                     inactive  (disabled on boot)
== Horizon service ==
openstack-dashboard:                    active
== neutron services ==
neutron-server:                         active
neutron-dhcp-agent:                     active
neutron-l3-agent:                       active
neutron-metadata-agent:                 active
neutron-lbaas-agent:                    active
neutron-lbaasv2-agent:                  inactive  (disabled on boot)
neutron-openvswitch-agent:              active
neutron-linuxbridge-agent:              inactive  (disabled on boot)
== Swift services ==
openstack-swift-proxy:                  active
openstack-swift-account:                active
openstack-swift-container:              active
openstack-swift-object:                 active
== Cinder services ==
openstack-cinder-api:                   active
openstack-cinder-scheduler:             active
openstack-cinder-volume:                active
openstack-cinder-backup:                inactive  (disabled on boot)
== Ceilometer services ==
openstack-ceilometer-api:               active
openstack-ceilometer-central:           active
openstack-ceilometer-compute:           active
openstack-ceilometer-collector:         active
openstack-ceilometer-notification:      active
== Heat services ==
openstack-heat-api:                     active
openstack-heat-api-cfn:                 active
openstack-heat-api-cloudwatch:          inactive  (disabled on boot)
openstack-heat-engine:                  active
== Support services ==
mariadb:                                active
openvswitch:                            active
dbus:                                   active
target:                                 active
rabbitmq-server:                        active
memcached:                              active
== Keystone users ==
/usr/lib/python2.7/site-packages/keystoneclient/shell.py:64: DeprecationWarning: The keystone CLI is deprecated in favor of python-openstackclient. For a Python library, continue using python-keystoneclient.
  'python-keystoneclient.', DeprecationWarning)
WARNING: unsupported identity-api-version 3, falling back to 2.0
/usr/lib/python2.7/site-packages/keystoneclient/v2_0/client.py:145: DeprecationWarning: Constructing an instance of the keystoneclient.v2_0.client.Client class without a session is deprecated as of the 1.7.0 release and may be removed in the 2.0.0 release.
  'the 2.0.0 release.', DeprecationWarning)
/usr/lib/python2.7/site-packages/keystoneclient/v2_0/client.py:147: DeprecationWarning: Using the 'tenant_name' argument is deprecated in version '1.7.0' and will be removed in version '2.0.0', please use the 'project_name' argument instead
  super(Client, self).__init__(**kwargs)
/usr/lib/python2.7/site-packages/debtcollector/renames.py:45: DeprecationWarning: Using the 'tenant_id' argument is deprecated in version '1.7.0' and will be removed in version '2.0.0', please use the 'project_id' argument instead
  return f(*args, **kwargs)
/usr/lib/python2.7/site-packages/keystoneclient/httpclient.py:371: DeprecationWarning: Constructing an HTTPClient instance without using a session is deprecated as of the 1.7.0 release and may be removed in the 2.0.0 release.
  'the 2.0.0 release.', DeprecationWarning)
/usr/lib/python2.7/site-packages/keystoneclient/session.py:140: DeprecationWarning: keystoneclient.session.Session is deprecated as of the 2.1.0 release in favor of keystoneauth1.session.Session. It will be removed in future releases.
  DeprecationWarning)
/usr/lib/python2.7/site-packages/keystoneclient/auth/identity/base.py:56: DeprecationWarning: keystoneclient auth plugins are deprecated as of the 2.1.0 release in favor of keystoneauth1 plugins. They will be removed in future releases.
  'in future releases.', DeprecationWarning)
Authorization Failed: The resource could not be found. (HTTP 404) (Request-ID: req-8722c6b3-c74c-414c-b8b1-d7943c6f6fa7)
== Glance images ==
+----+------+
| ID | Name |
+----+------+
+----+------+
== Nova managed services ==
+----+------------------+------------+----------+---------+-------+----------------------------+-----------------+
| Id | Binary           | Host       | Zone     | Status  | State | Updated_at                 | Disabled Reason |
+----+------------------+------------+----------+---------+-------+----------------------------+-----------------+
| 1  | nova-conductor   | controller | internal | enabled | up    | 2021-12-12T11:20:13.000000 | -               |
| 2  | nova-consoleauth | controller | internal | enabled | up    | 2021-12-12T11:20:13.000000 | -               |
| 3  | nova-scheduler   | controller | internal | enabled | up    | 2021-12-12T11:20:12.000000 | -               |
| 6  | nova-compute     | controller | nova     | enabled | up    | 2021-12-12T11:20:13.000000 | -               |
+----+------------------+------------+----------+---------+-------+----------------------------+-----------------+
== Nova networks ==
+----+-------+------+
| ID | Label | Cidr |
+----+-------+------+
+----+-------+------+
== Nova instance flavors ==
+----+-----------+-----------+------+-----------+------+-------+-------------+-----------+
| ID | Name      | Memory_MB | Disk | Ephemeral | Swap | VCPUs | RXTX_Factor | Is_Public |
+----+-----------+-----------+------+-----------+------+-------+-------------+-----------+
| 1  | m1.tiny   | 512       | 1    | 0         |      | 1     | 1.0         | True      |
| 2  | m1.small  | 2048      | 20   | 0         |      | 1     | 1.0         | True      |
| 3  | m1.medium | 4096      | 40   | 0         |      | 2     | 1.0         | True      |
| 4  | m1.large  | 8192      | 80   | 0         |      | 4     | 1.0         | True      |
| 5  | m1.xlarge | 16384     | 160  | 0         |      | 8     | 1.0         | True      |
+----+-----------+-----------+------+-----------+------+-------+-------------+-----------+
== Nova instances ==
+----+------+-----------+--------+------------+-------------+----------+
| ID | Name | Tenant ID | Status | Task State | Power State | Networks |
+----+------+-----------+--------+------------+-------------+----------+
+----+------+-----------+--------+------------+-------------+----------+

~~~



#### 46、Keystone服务运维

使用VMWare软件启动提供的opensatckallinone镜像，自行检查openstack中各服务的状态，若有问题自行排查。使用OpenStack命令创建用户testuser，密码为123456，创建好之后，使用命令修改testuser密码为000000，并查看testuser的详细信息，将上述所有操作命令和返回结果以文本形式提交到答题框。(20)分

~~~powershell
[root@controller ~]# openstack user create --password 123456 --domain xiandian testuser
+-----------+----------------------------------+
| Field     | Value                            |
+-----------+----------------------------------+
| domain_id | 9321f21a94ef4f85993e92a228892418 |
| enabled   | True                             |
| id        | c7eea533599a4e76a9bb41463beed74f |
| name      | testuser                         |
+-----------+----------------------------------+
[root@controller ~]# openstack user set --password 000000 testuser
[root@controller ~]# openstack user show testuser
+-----------+----------------------------------+
| Field     | Value                            |
+-----------+----------------------------------+
| domain_id | 9321f21a94ef4f85993e92a228892418 |
| enabled   | True                             |
| id        | c7eea533599a4e76a9bb41463beed74f |
| name      | testuser                         |
+-----------+----------------------------------+
~~~





#### 47、Glance服务运维

使用VMWare软件启动提供的opensatckallinone镜像，自行检查openstack中各服务的状态，若有问题自行排查。使用Glance命令，创建一个名称为“cirros”镜像，镜像文件使用xnode1镜像中提供的为“cirros-0.3.4-x86_64-disk.img”。通过glance 命令查看镜像“cirros”的详细信息。将上述所有操作命令及返回结果以文本形式填入答题框。(20)分

~~~powershell
//先需要将cirros-0.3.4-x86_64-disk.img文件熊Xnode1虚拟机中传送过来，openstackallinone中没有此文件
[root@controller ~]# glance image-create --name "cirros" --disk-format qcow2 --container-format bare --progress < cirros-0.3.4-x86_64-disk.img
[=============================>] 100%
+------------------+--------------------------------------+
| Property         | Value                                |
+------------------+--------------------------------------+
| checksum         | ee1eca47dc88f4879d8a229cc70a07c6     |
| container_format | bare                                 |
| created_at       | 2021-12-12T14:52:46Z                 |
| disk_format      | qcow2                                |
| id               | 61424a68-47d8-40a6-a90f-dbd99482fdfb |
| min_disk         | 0                                    |
| min_ram          | 0                                    |
| name             | cirros                               |
| owner            | f9ff39ba9daa4e5a8fee1fc50e2d2b34     |
| protected        | False                                |
| size             | 13287936                             |
| status           | active                               |
| tags             | []                                   |
| updated_at       | 2021-12-12T14:52:46Z                 |
| virtual_size     | None                                 |
| visibility       | private                              |
+------------------+--------------------------------------+
[root@controller ~]# glance image-list
+--------------------------------------+--------+
| ID                                   | Name   |
+--------------------------------------+--------+
| 61424a68-47d8-40a6-a90f-dbd99482fdfb | cirros |
+--------------------------------------+--------+
[root@controller ~]# glance image-show cirros								//此处不能输入镜像名字，需要输入镜像ID号，正确操作如下
404 Not Found: No image found with ID cirros (HTTP 404)
[root@controller ~]# glance image-show 61424a68-47d8-40a6-a90f-dbd99482fdfb
+------------------+--------------------------------------+
| Property         | Value                                |
+------------------+--------------------------------------+
| checksum         | ee1eca47dc88f4879d8a229cc70a07c6     |
| container_format | bare                                 |
| created_at       | 2021-12-12T14:52:46Z                 |
| disk_format      | qcow2                                |
| id               | 61424a68-47d8-40a6-a90f-dbd99482fdfb |
| min_disk         | 0                                    |
| min_ram          | 0                                    |
| name             | cirros                               |
| owner            | f9ff39ba9daa4e5a8fee1fc50e2d2b34     |
| protected        | False                                |
| size             | 13287936                             |
| status           | active                               |
| tags             | []                                   |
| updated_at       | 2021-12-12T14:52:46Z                 |
| virtual_size     | None                                 |
| visibility       | private                              |
+------------------+--------------------------------------+
~~~



#### 48、Cinder管理

使用VMWare软件启动提供的opensatckallinone镜像，自行检查openstack中各服务的状态，若有问题自行排查。使用cinder命令创建一个名字叫blockvolume，大小为2G的云硬盘，然后通过lvm相关命令查看该云硬盘详细信息，最后通过cinder命令对这块应该进行扩容操作，扩容后云硬盘大小为3G，并查看详细信息，将操作命令和返回结果以文本形式提交到答题框。(30)分

~~~powershell
[root@controller ~]# cinder create --name blockvolume 2
+--------------------------------+--------------------------------------+
|            Property            |                Value                 |
+--------------------------------+--------------------------------------+
|          attachments           |                  []                  |
|       availability_zone        |                 nova                 |
|            bootable            |                false                 |
|      consistencygroup_id       |                 None                 |
|           created_at           |      2021-12-12T14:57:08.000000      |
|          description           |                 None                 |
|           encrypted            |                False                 |
|               id               | 73856d68-c18a-412e-9851-ac31baae27d5 |
|            metadata            |                  {}                  |
|        migration_status        |                 None                 |
|          multiattach           |                False                 |
|              name              |             blockvolume              |
|     os-vol-host-attr:host      |                 None                 |
| os-vol-mig-status-attr:migstat |                 None                 |
| os-vol-mig-status-attr:name_id |                 None                 |
|  os-vol-tenant-attr:tenant_id  |   f9ff39ba9daa4e5a8fee1fc50e2d2b34   |
|       replication_status       |               disabled               |
|              size              |                  2                   |
|          snapshot_id           |                 None                 |
|          source_volid          |                 None                 |
|             status             |               creating               |
|           updated_at           |                 None                 |
|            user_id             |   0befa70f767848e39df8224107b71858   |
|          volume_type           |                 None                 |
+--------------------------------+--------------------------------------+
[root@controller ~]# lvmdiskscan
  /dev/loop0                                                      [       5.00 GiB] 
  /dev/centos/root                                                [      35.00 GiB] 
  /dev/sda1                                                       [     200.00 MiB] 
  /dev/centos/swap                                                [       4.00 GiB] 
  /dev/sda2                                                       [      39.01 GiB] LVM physical volume
  /dev/cinder-volumes/volume-73856d68-c18a-412e-9851-ac31baae27d5 [       2.00 GiB] 						//此处为云硬盘名称
  /dev/sda3                                                       [       5.00 GiB] LVM physical volume
  /dev/sda5                                                       [       5.00 GiB] 
  /dev/sdb                                                        [      20.00 GiB] 
  3 disks
  4 partitions
  0 LVM physical volume whole disks
  2 LVM physical volumes
[root@controller ~]# lvdisplay /dev/cinder-volumes/volume-73856d68-c18a-412e-9851-ac31baae27d5			//lvdisplay加上云硬盘名称
  --- Logical volume ---
  LV Path                /dev/cinder-volumes/volume-73856d68-c18a-412e-9851-ac31baae27d5
  LV Name                volume-73856d68-c18a-412e-9851-ac31baae27d5
  VG Name                cinder-volumes
  LV UUID                wOoPK5-Xlpn-EjPO-sGrV-GlNg-Ryph-ABP8DY
  LV Write Access        read/write
  LV Creation host, time controller, 2021-12-12 09:57:09 -0500
  LV Status              available
  # open                 0
  LV Size                2.00 GiB
  Current LE             512
  Segments               1
  Allocation             inherit
  Read ahead sectors     auto
  - currently set to     8192
  Block device           253:2
   
[root@controller ~]# cinder extend blockvolume 3
[root@controller ~]# cinder show blockvolume
+--------------------------------+--------------------------------------+
|            Property            |                Value                 |
+--------------------------------+--------------------------------------+
|          attachments           |                  []                  |
|       availability_zone        |                 nova                 |
|            bootable            |                false                 |
|      consistencygroup_id       |                 None                 |
|           created_at           |      2021-12-12T14:57:08.000000      |
|          description           |                 None                 |
|           encrypted            |                False                 |
|               id               | 73856d68-c18a-412e-9851-ac31baae27d5 |
|            metadata            |                  {}                  |
|        migration_status        |                 None                 |
|          multiattach           |                False                 |
|              name              |             blockvolume              |
|     os-vol-host-attr:host      |          controller@lvm#LVM          |
| os-vol-mig-status-attr:migstat |                 None                 |
| os-vol-mig-status-attr:name_id |                 None                 |
|  os-vol-tenant-attr:tenant_id  |   f9ff39ba9daa4e5a8fee1fc50e2d2b34   |
|       replication_status       |               disabled               |
|              size              |                  3                   |
|          snapshot_id           |                 None                 |
|          source_volid          |                 None                 |
|             status             |              available               |
|           updated_at           |      2021-12-12T14:57:46.000000      |
|            user_id             |   0befa70f767848e39df8224107b71858   |
|          volume_type           |                 None                 |
+--------------------------------+--------------------------------------+
~~~



#### 49、对象存储管理

使用VMWare软件启动提供的opensatckallinone镜像，自行检查openstack中各服务的状态，若有问题自行排查。使用openstack命令，创建名为examtest的容器并查询，上传一个aaa.txt（可自行创建）文件到这个容器中并查询。依次将操作命令和返回结果以文本形式提交到答题框。(30)分

~~~powershell
[root@controller ~]# touch aaa.txt
[root@controller ~]# swift post examtest
[root@controller ~]# swift upload examtest aaa.txt
aaa.txt
[root@controller ~]# swift list examtest
aaa.txt

[root@controller ~]# swift stat examtest
         Account: AUTH_f9ff39ba9daa4e5a8fee1fc50e2d2b34
       Container: examtest
         Objects: 1
           Bytes: 0
        Read ACL:
       Write ACL:
         Sync To:
        Sync Key:
   Accept-Ranges: bytes
X-Storage-Policy: Policy-0
     X-Timestamp: 1639308255.43527
      X-Trans-Id: txe39028e83d45439bab795-0061b5dc2b
    Content-Type: text/plain; charset=utf-8
    
[root@controller ~]# swift stat examtest aaa.txt
       Account: AUTH_f9ff39ba9daa4e5a8fee1fc50e2d2b34
     Container: examtest
        Object: aaa.txt
  Content Type: text/plain
Content Length: 0
 Last Modified: Sun, 12 Dec 2021 11:24:32 GMT
          ETag: d41d8cd98f00b204e9800998ecf8427e
    Meta Mtime: 1639308235.766952
 Accept-Ranges: bytes
   X-Timestamp: 1639308271.44098
    X-Trans-Id: tx870feab075af40eeba894-0061b5dc3c
~~~





#### 50、Docker使用

使用VMWare软件启动提供的k8sallinone镜像，该镜像已安装docker服务。创建/opt/xiandian目录，创建完成后启动名为xiandian-dir，镜像为nginx_latest.tar的容器（镜像在/root/images目录下），并指定/opt/xiandian为容器启动的数据卷，指定nginx的80端口映射到外部81端口。创建完成后通过inspect命令指定查看数据卷的情况。将以上操作命令及返回结果以文本形式填入答题框。(30)分

~~~powershell
[root@master ~]# docker load -i images/nginx_latest.tar 
b67d19e65ef6: Loading layer [==================================================>]   72.5MB/72.5MB
6eaad811af02: Loading layer [==================================================>]  57.54MB/57.54MB
a89b8f05da3a: Loading layer [==================================================>]  3.584kB/3.584kB
Loaded image: nginx:latest
[root@master ~]# mkdir /opt/xiandian
[root@master ~]# docker run -itd --name xiandian-dir -v /opt/xiandian -p 81:80 nginx:latest
0a7c4da1ae93b5150f4f799fa83a305b8260ad2eb9980df84f1a64cb68b57f39
[root@master ~]# docker ps
CONTAINER ID        IMAGE               COMMAND                  CREATED             STATUS              PORTS                NAMES
0a7c4da1ae93        nginx:latest        "nginx -g 'daemon of…"   35 seconds ago      Up 33 seconds       0.0.0.0:81->80/tcp   xiandian-dir
[root@master ~]# docker inspect 0a7c4da1ae93 | grep -C 5 /opt/xiandian			//此处仅输入“docker inspect 0a7c4da1ae93”即可，“inspect”之后需要输入容器的ID，所以需要上一步docker ps来进行查询

        "Mounts": [
            {
                "Type": "volume",
                "Name": "e51a876570c1ad91738565195f15d7cb6c8d3da8a99209120fc829192e9bb94c",
                "Source": "/var/lib/docker/volumes/e51a876570c1ad91738565195f15d7cb6c8d3da8a99209120fc829192e9bb94c/_data",
                "Destination": "/opt/xiandian",
                "Driver": "local",
                "Mode": "",
                "RW": true,
                "Propagation": ""
            }
--
                "daemon off;"
            ],
            "ArgsEscaped": true,
            "Image": "nginx:latest",
            "Volumes": {
                "/opt/xiandian": {}
            },
            "WorkingDir": "",
            "Entrypoint": null,
            "OnBuild": null,
            "Labels": {
~~~





#### 51、Docker Compose

使用VMWare软件启动提供的k8sallinone镜像，完成docker compose案例，compose案例所有用到的文件均在/root/compose目录下，需要用到的镜像均在/root/images目录下。理解docker compose的原理与工作流程，在/root目录下新建composetest目录作为工作目录，理解提供的配置文件与部署文件，运行docker compose案例。运行成功后，使用curl命令访问http://IP:5000。最后将运行docker-compose up的结果和curl的结果以文本形式提交到答题框。(40)分

~~~powershell
[root@master ~]# docker load -i /root/images/redis_alpine.tar
77cae8ab23bf: Loading layer [==================================================>]  5.815MB/5.815MB
cb870b273d7a: Loading layer [==================================================>]  11.78kB/11.78kB
f1a14f529f99: Loading layer [==================================================>]  2.209MB/2.209MB
8fc2bb5430a1: Loading layer [==================================================>]  22.45MB/22.45MB
d2277c911874: Loading layer [==================================================>]  1.536kB/1.536kB
068dd9f815df: Loading layer [==================================================>]  3.584kB/3.584kB
Loaded image: redis:alpine
[root@master ~]# docker load -i /root/images/python_3.5-alpine.tar
bcf2f368fe23: Loading layer [==================================================>]  5.792MB/5.792MB
aabe8fddede5: Loading layer [==================================================>]  818.7kB/818.7kB
fbe16fc07f0d: Loading layer [==================================================>]  63.54MB/63.54MB
58026b9b6bf1: Loading layer [==================================================>]  4.608kB/4.608kB
62de8bcc470a: Loading layer [==================================================>]  6.455MB/6.455MB
c04ba02fe449: Loading layer [==================================================>]  2.048kB/2.048kB
b55b6c3c7bae: Loading layer [==================================================>]  12.42MB/12.42MB
Loaded image: python:3.5-alpine
[root@master ~]# mkdir composetest
[root@master ~]# cd composetest/
[root@master composetest]# cp /root/compose/* .
[root@master composetest]# ln -s /root/composetest/docker-compose /usr/bin/docker-compose
[root@master composetest]# chmod +x /root/composetest/docker-compose
[root@master composetest]# ll
total 16536
-rw-r--r-- 1 root root      583 Dec 12 08:18 app.py
-rwxr-xr-x 1 root root 16912904 Dec 12 08:18 docker-compose
-rw-r--r-- 1 root root      109 Dec 12 08:18 docker-compose.yml
-rw-r--r-- 1 root root       74 Dec 12 08:18 Dockerfile
-rw-r--r-- 1 root root       12 Dec 12 08:18 requirements.txt
[root@master composetest]# docker-compose -v
docker-compose version 1.25.0-rc2, build 661ac20e

[root@master composetest]# docker-compose up
Creating network "composetest_default" with the default driver
Building web
Step 1/4 : FROM python:3.5-alpine
 ---> 96b4e8050dda
Step 2/4 : ADD . /code
 ---> 6677d56701f3
Step 3/4 : WORKDIR /code
 ---> Running in 86d66bbdd72b
Removing intermediate container 86d66bbdd72b
 ---> 7e22b1e08ef6
Step 4/4 : CMD ["python", "app.py"]
 ---> Running in ab6e37d97eb9
Removing intermediate container ab6e37d97eb9
 ---> 59feb4fc59ef
Successfully built 59feb4fc59ef
Successfully tagged composetest_web:latest
WARNING: Image for service web was built because it did not already exist. To rebuild this image you must use `docker-compose build` or `docker-compose up --build`.
Creating composetest_redis_1 ... done
Creating composetest_web_1   ... done
Attaching to composetest_redis_1, composetest_web_1
redis_1  | 1:C 12 Dec 2021 13:20:51.007 # oO0OoO0OoO0Oo Redis is starting oO0OoO0OoO0Oo
redis_1  | 1:C 12 Dec 2021 13:20:51.008 # Redis version=5.0.6, bits=64, commit=00000000, modified=0, pid=1, just started
redis_1  | 1:C 12 Dec 2021 13:20:51.008 # Warning: no config file specified, using the default config. In order to specify a config file use redis-server /path/to/redis.conf
redis_1  | 1:M 12 Dec 2021 13:20:51.010 * Running mode=standalone, port=6379.
redis_1  | 1:M 12 Dec 2021 13:20:51.010 # WARNING: The TCP backlog setting of 511 cannot be enforced because /proc/sys/net/core/somaxconn is set to the lower value of 128.
redis_1  | 1:M 12 Dec 2021 13:20:51.010 # Server initialized
redis_1  | 1:M 12 Dec 2021 13:20:51.010 # WARNING overcommit_memory is set to 0! Background save may fail under low memory condition. To fix this issue add 'vm.overcommit_memory = 1' to /etc/sysctl.conf and then reboot or run the command 'sysctl vm.overcommit_memory=1' for this to take effect.
redis_1  | 1:M 12 Dec 2021 13:20:51.010 # WARNING you have Transparent Huge Pages (THP) support enabled in your kernel. This will create latency and memory usage issues with Redis. To fix this issue run the command 'echo never > /sys/kernel/mm/transparent_hugepage/enabled' as root, and add it to your /etc/rc.local in order to retain the setting after a reboot. Redis must be restarted after THP is disabled.
redis_1  | 1:M 12 Dec 2021 13:20:51.010 * Ready to accept connections
web_1    |  * Serving Flask app "app" (lazy loading)
web_1    |  * Environment: production
web_1    |    WARNING: This is a development server. Do not use it in a production deployment.
web_1    |    Use a production WSGI server instead.
web_1    |  * Debug mode: on
web_1    |  * Running on http://0.0.0.0:5000/ (Press CTRL+C to quit)
web_1    |  * Restarting with stat
web_1    |  * Debugger is active!
web_1    |  * Debugger PIN: 167-764-931
web_1    | 192.168.100.20 - - [12/Dec/2021 13:21:57] "GET / HTTP/1.1" 200 -
web_1    | 192.168.100.20 - - [12/Dec/2021 13:21:58] "GET / HTTP/1.1" 200 -
web_1    | 192.168.100.20 - - [12/Dec/2021 13:21:59] "GET / HTTP/1.1" 200 -
web_1    | 192.168.100.20 - - [12/Dec/2021 13:22:00] "GET / HTTP/1.1" 200 -
web_1    | 192.168.100.20 - - [12/Dec/2021 13:22:01] "GET / HTTP/1.1" 200 -

#在SecureCRT中为K8S再克隆一个会话，然输入

[root@master ~]# curl http://192.168.100.20:5000
Hello World! I have been seen 1 times.
[root@master ~]# curl http://192.168.100.20:5000
Hello World! I have been seen 2 times.
[root@master ~]# curl http://192.168.100.20:5000
Hello World! I have been seen 3 times.
[root@master ~]# curl http://192.168.100.20:5000
Hello World! I have been seen 4 times.
[root@master ~]# curl http://192.168.100.20:5000
Hello World! I have been seen 5 times.
~~~





#### 52、K8S平台安装

使用VMWare软件启动提供的k8sallinone镜像，确认IP地址，执行/root目录下的install.sh脚本进行一键部署K8S平台。等待安装完毕后使用kubectl 命令查看nodes、cs、pods的状态，将查看的命令与返回结果以文本形式提交到答题框。(30)分

~~~powershell
[root@master ~]# ./install.sh 
请输入本节点IP:192.168.100.20								//此处需要输入k8s主机的IP地址
.........................
Type:  kubernetes.io/service-account-token

Data
====
ca.crt:     1025 bytes
namespace:  11 bytes
token:      eyJhbGciOiJSUzI1NiIsImtpZCI6IiJ9.eyJpc3MiOiJrdWJlcm5ldGVzL3NlcnZpY2VhY2NvdW50Iiwia3ViZXJuZXRlcy5pby9zZXJ2aWNlYWNjb3VudC9uYW1lc3BhY2UiOiJrdWJlLXN5c3RlbSIsImt1YmVybmV0ZXMuaW8vc2VydmljZWFjY291bnQvc2VjcmV0Lm5hbWUiOiJrdWJlcm5ldGVzLWRhc2hib2FyZC1hZG1pbi10b2tlbi1wenIyNSIsImt1YmVybmV0ZXMuaW8vc2VydmljZWFjY291bnQvc2VydmljZS1hY2NvdW50Lm5hbWUiOiJrdWJlcm5ldGVzLWRhc2hib2FyZC1hZG1pbiIsImt1YmVybmV0ZXMuaW8vc2VydmljZWFjY291bnQvc2VydmljZS1hY2NvdW50LnVpZCI6ImJmMzZmZWZlLTViNTAtMTFlYy1iM2YzLTAwMGMyOTdkYzAwMyIsInN1YiI6InN5c3RlbTpzZXJ2aWNlYWNjb3VudDprdWJlLXN5c3RlbTprdWJlcm5ldGVzLWRhc2hib2FyZC1hZG1pbiJ9.XFdyANBUP4dpGqc44pkyFP6kHgaqslTsPpqmOcihgWYhwwuMEu5mk4YS5QXSKYmTx0BhtPezzI-CMncdLm0NFftdDYH9wGNsjeK7tj91Do_0ip-4HiWmu_2rhV8gSD9_r-Fdo_bllTUsN5l8COmUFSTDP4T5Tb0bKvSHb4QwsowWk4FgF19KmO2XtK5uz4Y1-h7em21sgP-moIOiBH0vFocdvJDEbIc1sTloR4EJ2VgSt7XRxdPZTdqW6JVd6mZSAlw9BDVsrDgBVUAXisaLQ66uI43CpIif0cyEjhe6-99XP4F30YegezS3o4yVwmSpDJkzN_LFwnVnuqzPIZPe2w

[root@master ~]# kubectl get nodes
NAME     STATUS   ROLES    AGE     VERSION
master   Ready    master   5m36s   v1.14.1
[root@master ~]# kubectl get cs
NAME                 STATUS    MESSAGE             ERROR
scheduler            Healthy   ok                  
controller-manager   Healthy   ok                  
etcd-0               Healthy   {"health":"true"}   
[root@master ~]# kubectl get pods
No resources found.
[root@master ~]# kubectl get pods -A
NAMESPACE     NAME                                    READY   STATUS    RESTARTS   AGE
kube-system   coredns-8686dcc4fd-6hmk4                1/1     Running   0          6m3s
kube-system   coredns-8686dcc4fd-spnqq                1/1     Running   0          6m3s
kube-system   etcd-master                             1/1     Running   0          5m8s
kube-system   kube-apiserver-master                   1/1     Running   0          5m9s
kube-system   kube-controller-manager-master          1/1     Running   0          5m21s
kube-system   kube-flannel-ds-amd64-q6fcp             1/1     Running   0          5m57s
kube-system   kube-proxy-ccglr                        1/1     Running   0          6m3s
kube-system   kube-scheduler-master                   1/1     Running   0          5m6s
kube-system   kubernetes-dashboard-5f7b999d65-jdb6t   1/1     Running   0          5m46s
~~~





#### 53、shell脚本补全

下面有一段shell脚本，作用是自动配置mysql服务，由于工程师的失误，将脚本中的某些代码删除了，但注释还在，请根据注释，填写代码。最后将填写的代码按照顺序以文本形式提交至答题框。脚本如下所示：(30)分

~~~powershell
#! /bin/bash 
mariadb(){
cd
#在数据库的my.cnf文件添加内容如下
（此处需填写） 
[mysqld]
init_connect='SET collation_connection = utf8_unicode_ci'
init_connect='SET NAMES utf8'
character-set-server=utf8
collation-server=utf8_unicode_ci
skip-character-set-client-handshake
EOF
#启动数据库
 systemctl start mariadb
#设置数据库root的密码为123456
mysqladmin -uroot password 123456
#创建gpmall数据库，并将/root/gpmall.sql文件导入
mysql -uroot -p123456 << EOF
（此处需填写）
EOF
#设置开机自启数据库
systemctl enable mariadb
#重启数据库服务systemctl restart mariadb
#检查数据库是否重启成功
if [ $? -eq 0 ]
  then 
    sleep 3
    echo -e "\033[36m==========maridb启动成功=========\033[0m"
  else
    echo -e "\033[31m******mariadb启动失败，请检查******\033[0m" 
    exit 1
  fi
sleep2
}
~~~



答案填写：

~~~powershell
#第一处填写：
cat > /etc/my.cnf << EOF

#第二处填写：
create database gpmall;
use gpmall;
source /root/gpmall.sql;
~~~

