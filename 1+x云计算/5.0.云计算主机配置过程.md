1、编辑VMware虚拟网络编辑器
VMnet1	192.168.100.0
VMnet8	192.168.200.0

2、创建两台CentOS 7虚拟机，处理器开启虚拟化技术
计算机名		处理器	内存	硬盘		网络
computer			2个	8G	100G、50G、50G	适配器-仅主机、适配器2-NAT
controller			1个	4G	100G		适配器-仅主机、适配器2-NAT

3、使用最小化安装两台CentOS7
语言选择EN，最小化安装，关闭Kdump
分区：
/boot	200M
swap	8G
/	剩余全部				//容量空着，不用输入/

4、两台虚拟机分别配置主机名和静态IP地址
controller节点
#hostnamectl  set-hostname  controller
#bash
#hostnamectl					//确认新主机名生效
#vi  /etc/sysconfig/network-scripts/ifcfg-eno16777736
BOOTPROTO=static
ONBOOT=yes
IPADDR=192.168.100.10
PREFIX=24
GATEWAY=192.168.100.1
#vi   /etc/sysconfig/network-scripts/ifcfg-eno33554960
BOOTPROTO=static
ONBOOT=yes
IPADDR=192.168.200.10
PREFIX=24
GATEWAY=192.168.200.1
#systemctl   restart    network
# ip a						//检查两块网卡IP地址已经生效

computer节点
#hostnamectl  set-hostname  computer
#bash
#hostnamectl					//确认新主机名生效
#vi  /etc/sysconfig/network-scripts/ifcfg-eno16777736
BOOTPROTO=static
ONBOOT=yes
IPADDR=192.168.100.20
PREFIX=24
GATEWAY=192.168.100.1
#vi   /etc/sysconfig/network-scripts/ifcfg-eno33554960
BOOTPROTO=static
ONBOOT=yes
IPADDR=192.168.200.20
PREFIX=24
GATEWAY=192.168.200.1
#systemctl   restart    network
# ip   a						//检查两块网卡IP地址已经生效

5、使用SecureCRT同时连接两台虚拟机（连接192.168.100.0的IP），在controller节点，上传两个iso镜像文件

6、关闭防火墙和SELINUX安全模式（controller、compute）
# systemctl   stop   firewalld
# systemctl   disable   firewalld
# vi    /etc/selinux/config 
SELINUX=disabled					//将enforcing修改成disabled
# setenforce    0
# getenforce					//结果应为Permissive
# iptables  -F
# iptables  -X
# iptables  -Z
# iptables-save


7、配置域名解析（controller、computer）
controller节点
# vi    /etc/hosts		//在此文件最后添加两行
192.168.100.10	controller
192.168.100.20	computer

computer节点
# scp   192.168.100.10://etc/hosts   /etc/hosts		//将controller的hosts文件同步到computer，期间要输入controller主机的root密码

8、修改yum源（controller）
# cd   /
# rm  -f   /etc/yum.repos.d/*      /opt/
# mkdir    /opt/centos     /opt/iaas
# ll     /opt/					//确认两个文件夹已经建立
# mount   -o   loop   /root/CentOS-7-x86_64-DVD-1511.iso   /opt/centos
# mount   -o   loop   /root/XianDian-IaaS-v2.2.iso    /opt/iaas
# vi    /etc/yum.repos.d/centos.repo			//输入如下的信息
[centos]
name=centos
baseurl=file:///opt/centos
gpgcheck=0
enabled=1

[iaas]
name=iaas
baseurl=file:///opt/iaas/iaas-repo
gpgcheck=0
enabled=1

# yum  clean  all					//清除缓存
# yum  repolist					//验证yum源

9、在controller上搭建ftp服务器，开启并设置自启（controller）
# yum    install    -y    vsftpd
# vi /etc/vsftpd/vsftpd.conf
anon_root=/opt					//在最上面添加此行

# systemctl start vsftpd				//启动ftp服务
# systemctl enable vsftpd				//使ftp在每次启动时自动启动

10、修改yum源（computer）
# cd   /
# rm  -f     /etc/yum.repos.d/*      /opt/
# vi    /etc/yum.repos.d/centos.repo			//输入如下的信息
[centos]
name=centos
baseurl=ftp://controller/centos
gpgcheck=0
enabled=1

[iaas]
name=iaas
baseurl=ftp://controller/iaas/iaas-repo
gpgcheck=0
enabled=1

# yum  clean  all					//清除缓存
# yum  repolist					//验证yum源

11、计算节点分区（cinder和swift）
# fdisk  /dev/sdb              n 默认  默认  默认  默认   w
# fdisk  /dev/sdc               n 默认  默认  默认  默认   w
# mkfs.xfs    /dev/sdb1
# mkfs.xfs    /dev/sdc1
# parted   -l


12、安装xiandian脚本，编辑环境变量（controller、computer）
yum   install    iaas-xiandian   -y
vi   /etc/xiandian/openrc.sh
具体设置参见书上P173-174页。

在computer节点上同步controller上的这个文件
scp   controller://etc/xiandian/openrc.sh   /etc/xiandian/openrc.sh 

13、安装服务
controller安装：		computer安装：
基础服务		基础服务
注意：基础服务安装完毕之后（Please Reboot or Reconnect the terminal），按Ctrl+D退出并重新登录一次。
MySQL			X
Keystone			X
Glance			X
Nova			Nova
Neutron			Neutron
Dashboard		X
Cinder			Cinder
Swift			Swift

注意controller节点和computer节点的命令不同
# iaas-install-nova-controller.sh
# iaas-install-nova-compute.sh

14、访问Dashboard服务
http://192.168.100.10/dashboard
