# FusionComuter

 

IaaS   Infrastructure as a Service    基础架构即服务

PaaS   Platform as a server    平台即服务 docker容器  K8S

SaaS   Software as a Service      软件即服务 网易云音乐，百度网盘

虚拟化优势：提高服务器利用率、提升管理效率

虚拟化行业老大：VMware

云计算行业老大：AWS(亚马逊)

开源虚拟化： XEN  KVM

VMware虚拟化解决方案： VMware vSphere

华为虚拟化解决方案： Fusion vSphere

VRM:Virtual Resource Management 虚拟资源管理

CNA:Computer Node Agent 计算节点代理

FusionComputer 6.1 之前 SUSE Enterprise Linux 11 X64

FusionComputer 6.1(包括6.1)  EulerOS 欧拉OS  Opne Euler

FusionComputer 6.3 之前 XEN

FusionComputer 6.3(包括6.3) KVM

CentOS:Community Enterprise Operation System

KVM:Kernel-based Virtual Machine

VMM: Virtual Machine Monitor  虚拟机监视器

各厂商服务器远程管理口都基于Intel IPMI 2.0开源标准

基板管理控制器(Baseboard Manager Controller)

Intel IPMI

IBM   RSA

HP   iLO

DELL   DRAC

HUAWEI iBMC

当CNA数量超过50台，VRM物理部署，否则虚拟化部署

热迁移  在线迁移  不停业务 迁移的是内存中的数据

冷迁移 停止业务迁移

FusionCompute安装流程：安装两台CNA、使用fusionCompute Tools将VRM部署到CNA中、使用VRM管理CNA和集群

在Hypervisor上进行着计算虚拟化、存储虚拟化、网络虚拟化

XEN虚拟化

需要升级内核，kernel-xen内核;

内核不能直接与虚拟机交流，需要通过domain0这个特殊的虚拟机。

KVM虚拟化

直接使用内核，不需要专门内核;

虚拟机就是一个系统进程，可以直接使用原有内核机制;

更加轻量;

接近裸机90%性能。

红帽收购KVM

Citrix——XEN——CloudStack

RHEL——KVM——OpenStack

阿里巴巴的云系统:飞天-自研

为什么KVM击败了XEN

XEN需要升级内核，维护一套内核，进来的数据包需要Domain0来处理;

KVM更加轻量，通过内核模块实现，一个VM就是一个进程;

XEN被Citrix收购，支持CloudStack、KVM被红帽收购，支持OpenStack。

OpenStack社区更加流行，有更多厂商支持。

基于内核的虚拟机

glusterfs

ceph

ansible

X86 ISA中有19条敏感指令不是特权指令，因此x86无法使用经典的虚拟化技术完全虚



 https://blog.csdn.net/gui951753/article/details/81507924﻿

**半虚拟化**

VT-X  虚拟机只能安装linux，不能安装windows，因为需要修改虚拟机内核以支持虚拟化

**完全虚拟化**

**硬件辅助虚拟化**

Intel VT-X  

AMD  AMD-V(BIOS中开启，开启就是硬件辅助虚拟化，不开就是完全虚拟化)

如果是Linux，则自带virtIO驱动，如果是windows ，则需要额外安装virtio驱动

在硬件辅助虚拟化环境中安装半虚拟化驱动来提升IO性能

virtIO drivers

如何判断服务器是否支持硬件辅助虚拟化

\#lscpu

\#cat /proc/cpuinfo | grep vmx Intel

\#cat /proc/cpuinfo | grep svm AMD

只有XEN有Domain0，跟硬件辅助虚拟化和硬件半虚拟化无关，KVM也有半虚拟化(需要驱动支持 PV Drive)和硬件辅助虚拟化，无需Domain0。

![https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/06BF75D2E687487DA37A80A1E121A865/12871](./.图片存放/12871.png)

 

vcpus:插槽数*核数*线程数 #2*10*2=80 vcpus

内存复用:默认是内存*150%可用

内存复用与NUMA不能同时开启

 

![https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/8D0F7DE31CFD4BC3AF5407FD870BD20A/13100](./.图片存放/13100.png)

 

票数解决方案防止脑裂

什么是集群

由两台或者两台以上的主机，共同完成一个商业目标，根据业务不同，集群分为

HA 高可用集群

LBC  负载均衡集群  HPC  高性能集群

为什么需要多个集群

根据业务、根据组织架构、根据硬件

…………

如果VRM物理部署，手动创建集群以及分布式虚拟交换机

VRM虚拟化部署

自动建立了一个ManagementCluster集群

20台服务器

2台服务器用于安装管理虚拟机，放在一个单独的集群中，其他服务器单独创建一个集群

用于安装业务虚拟机

fusionstorage 华为分布式存储  FSM  DNS  AD  DHCP

同一个模板部署出来的虚拟机

什么是HA

什么是DRS 分布式资源调度  动态资源调度

DPM： 动态电源管理

BMC

**计算虚拟化**

创建集群

**2.1.主机内存复用** **#面试必考**

(1)：开启可以提高虚拟机开机密度，默认150%。

(2)：关闭提高虚拟机性能。

内存共享  COW： 写时复制  Copy on write

同一个模板部署的虚拟机可使用此功能

内存置换：swap分区

内存气泡

 

![https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/EB36A5A5163B4B66956525D43CC0DC6F/12853](./.图片存放/12853.png)

 

**2.2.虚拟机启动策略**

(1)负载均衡：开机时，可以让虚拟机均衡的运行在集群的主机上。

(2)自动分配：减少VRM的计算压力。

**2.3.虚拟机NUMA结构自动调整**

NUMA架构：

 

![https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/3BD91BA16AD947E1A4FB1F2D4950E35C/12898](./.图片存放/12898.png)

 

FSB:前端总线，会出现性能瓶颈

NUMA架构如下图：

QPI：快速通道互联

 



 

NUMA：非一致性内存访问

(1)：虚拟机运行时会自动感知NUMA架构，让虚拟机尽量运行在一个NUMA Node中。

(2)：与内存复用功能互斥，也会带来更多的开销。

 

![https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/1F54ECD52C7B4843A4EB5ACE10B7624B/12900](./.图片存放/12900.png)

 

**2.4.开启故障与响应策略**

(1)：主机故障处理策略

(2)：数据存储故障处理策略

不处理：如果出现间歇性故障，不处理更合适。

HA：如果出现故障，HA更合适。

Windows虚拟机蓝屏处理策略：利用虚拟机Tools功能来充当心跳检测机制，来检测的状态，一旦CNA检测不到Tools心跳，就认为虚拟机蓝屏，通过宿主机将虚拟机强制重启。即通过KVM命令强制重启虚拟机

\#virsh destory xxx

**2.5.接入控制策略**

允许故障的数目：在规划时需要预留30%的资源以防止集群中有主机故障保证所有的虚拟机都能正常运行。

**2.6.群体性故障**

在2个小时内如果出现多个主机故障只处理前两个故障的主机。

**2.7.启用计算资源调度**

DRS

根据CPU和内存的使用情况在集群中进行虚拟机迁移，来达到均衡的目的。

**2.8.电源管理**

根据集群的负载情况，如果负载低，就把所有的主机迁移到一部分主机上，把剩余的主机关机，来降低功耗，当业务负载高，则自动开机，将虚拟机迁移到新开机的主机，来达到负载均衡。

**2.9.开启IMC机制**

开启Intel的兼容性，使得不同批次的服务器在同一个集群中继续工作，降低高配的服务器性能。

DRS:分布式资源调度

DPM:分布式电源管理

不同厂商的服务器，如果CPU指令集一样，是可以放在同一个集群的

虚拟机内存不能跨主机

为什么要创建多个集群？

服务器硬件配置、根据部门来管理、根据业务场景web+sql   mail+oa+erp、根据集群规则

清除VRM信息:在CNA节点中

\#echo > /etc/vna-api/vrminfo  

\#systemctl restart vna-api

**存储虚拟化**

华为OceanStro系列，四块保险盘做RAID1

BBU: 后备电池单元

 

![https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/3883E30B3BD0484BAA995D8CDE8DBE28/12961](./.图片存放/12961.png)

 

一、配置存储流程

\1. 创建硬盘域

\2. 创建存储池

\3. 创建LUN

\4. 创建LUN组，并加LUN加入LUN组

\5. 创建主机

\6. 创建主机组，将主机加入主机组

\7. 创建映射，将LUN组映射给主机组

\8. 给主机添加启动器

（1）如果是FC-SAN，则只需要开机，主机的光纤卡WWPN就可以在存储上看到了，将WWPN添加给主机即可

（2）如果是IP-SAN，则需要给存储的业务接口（比如H0口）配置规划的IP地址

（4）如果是IP-SAN，则需要在windows的ISCSI发起程序中，添加目标器地址（存储业务接口IP），如果连接成功，则主机的IQN会在存储上可以看到

（5）在存储上host001上添加windows主机的IQN或者WWPN

\9. 在windows主机上扫描新磁盘，初始化，分区，格式化，写入数据

**3.1.raid技术** 

RAID： 廉价冗余独立磁盘阵列 Redundant Array of Independent Disks

RAID0  条带化  >=2 块以上的硬盘

![https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/23A36074390746F2AD5E861E17A4E9F2/13101](./.图片存放/13101.png)

 

RAID5 校验数据在专门的一块校验盘中，可使用总数为SUM-1，重构时，写入的数据优先级高于重构数据。

 

![https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/FC996173AE0B454D9F07AAC34939883E/13105](./.图片存放/13105.png)

 

RAID6 需要磁盘数量>=4 可以坏任意一块盘

 

![https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/FDCD60FD4DC44F0495293E177AC0730F/13126](./.图片存放/13126.png)

 

4快盘做RAID10或者RAID5，那个性能更好？

 

![https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/469AC260C1474097B4DFD6B35C0862AA/13106](./.图片存放/13106.png)

 

顺序大IO RAID5 视频监控，数据备份

随机小IO RAID10 12306买票，如果使用RAID5，会频繁更改校验数据，开销大

VMware磁盘格式：vmdk

HUAWEI磁盘模式：vhd

KVM磁盘格式：qcow2

**3.2.磁盘配置模式**

精简模式：创建完，不进行初始化，没有填0，使用时，写多少数据就填多少个0；

优点：按需分配，不占用未使用空间；

缺点：性能差，等到全部填完0之后与普通模式性能一样。

普通模式：创建完磁盘后，不管是否写入数据，全部用0填充；

优点：性能好；

缺点：创建速度慢。

普通延迟置零：创建完磁盘后，不用0填充，待第一次写入数据时，则全部用0填充；

优点：创建时不占用磁盘性能，待使用时性能好；

缺点：第一次写入数据慢。

**3.3.华为两种改变磁盘配置模式方法**

vmware可以直接吧精简卷转换为普通卷，不能回转

华为不能直接转换，需要通过克隆虚拟机或者迁移数据存储实现转换

磁盘类型：

普通：只能给一个主虚拟机使用，磁盘模式和磁盘配置模式可以根据共享存储类型来选择

共享：可以给多个虚拟机使用，磁盘配置模式只能选择“普通模式”，不支持在线扩容。

**3.4.磁盘模式**

从属：快照全拍

独立-持久：快照不拍数据盘

独立-非持久：类似于还原卡

差分盘

a.安装好OS、APP，配置好系统，可以正常使用

b.关机，更改磁盘为独立-非持久

c.开机，写入数据

d.关机，开机，测试数据是否还在(重启数据不丢失，关机电源才丢失数据)

\1. 安装完操作系统，安装好软件并配置，已经可以正常使用了

\2. 关机，并修改磁盘模式为独立-非持久

\3. 开机会产生一个差分磁盘文件，从此新写入的数据将会写入到该磁盘中，如果是读旧数据，将通过指针读到源盘

\5. 当将虚拟机关机后，CNA删除差分盘，下次开机重新生成差分盘

当前CNA01上有个虚拟机，磁盘模式为从属

 

![https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/604B980125BA4931A013C9A108EBC1DC/13113](./.图片存放/13113.png)

 

配置文件在其正在运行的CNA下/etc/libvirt/qemu 目录下，打开xxx.xml配置文件可以找到其磁盘的目录

 

![https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/DB1AE5E81C1B40FDB73DC53D4D7ED2FC/13046](./.图片存放/13046.png)

 

\# vim i-0000003A.xml

其磁盘位置位于 /POME/datastore_5/vol/vol_46462437-eb4c-4936-95e9-70941975d819

这个目录下，磁盘名称为 vol_46462437-eb4c-4936-95e9-70941975d819.img

 

![https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/635A3C6DDB1C4AC09BCF9F04B7746CDF/13030](./.图片存放/13030.png)

 

此磁盘文件位于共享存储上，可打开目录查看

\#cd /POME/datastore_5/vol/vol_46462437-eb4c-4936-95e9-70941975d819

 

![https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/B9D7DC01D24C43AE9FA2751C45DF4DB4/12955](./.图片存放/12955.png)

 

\#ll -h #查看文件大小为40G

\#du -sh #实际使用9.0G,因为是精简配置

 

![https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/D2BF2B81EAC34886823AF9430DC0B54D/12976](./.图片存放/12976.png)

 

现在更改虚拟机磁盘模式为 独立-非持久

 

![https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/0508394FB02641E8A0F1884387E0A1BC/13103](./.图片存放/13103.png)

 

此时打开虚拟机配置文件，查看磁盘所在位置，可以看到，此时的目录和磁盘名称都和原来的不同了/POME/datastore_5/vol/vol_61351902-15a9-4d14-b1a9-3e56799f5a65/vol_61351902-15a9-4d14-b1a9-3e56799f5a65.img

 

![https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/EC08EE5873F047BA8A399006E9160556/13039](./.图片存放/13039.png)

 

查看一下磁盘文件大小

\#ll -h #可以看到，只有46M

\#du -sh #这就是差分盘

 

![https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/DD23DA4F1AA94B0F9C47360B74D35ADB/12935](./.图片存放/12935.png)

 

现在在虚拟机生成一些数据，在来看这个磁盘大小

 

![https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/A91DBABF28204086879BA7853B814E26/12974](./.图片存放/12974.png)

 

可以看到，磁盘由46M变成166M，因为现在写的数据都在这个差分盘中，现在关闭虚拟机，然后开机(重启无效)，那么差分盘就会重新生成，如下：

/POME/datastore_5/vol/vol_ae557a31-a6c4-40a9-ba18-610cb3813eb6/vol_ae557a31-a6c4-40a9-ba18-610cb3813eb6.img

 

![https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/8206506C1EBF4B4BB0BB4C3535672FB2/13029](./.图片存放/13029.png)

 

此时大小就回归刚刚创建的大小了

 

![https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/1886A03F87DF4226A6D9A0878B11C02E/12910](./.图片存放/12910.png)

 

现在吧磁盘类型改为从属，看看磁盘是不是母盘

 

![https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/3F2A82FD6F18412AA39187605CE9763C/13092](https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/3F2A82FD6F18412AA39187605CE9763C/13092)

 

查看磁盘名称，和第一次查看时的名称和目录一致

/POME/datastore_5/vol/vol_46462437-eb4c-4936-95e9-70941975d819/vol_46462437-eb4c-4936-95e9-70941975d819.img

 

![https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/F11F0D161B4F49F19E65E1B42F924716/13027](./.图片存放/13027.png)

 

磁盘大小一致，这就是差分盘

 

![https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/709F30E91E0249B983BC009C0CB43EBC/12952](./.图片存放/12952.png)

 

**3.5.快照**

裸设备做快照：COW

带文件系统的虚拟机：ROW

脏数据：在内存中发生变化还没有写回磁盘的数据

赃页：Dirty 在/proc/meninfo中可查看到

\#watch -n 1 ‘cat proc/meninfo | grep Dirty’ #查看1s内脏数据

\#sync #刷脏页

脏数据必须回收，否则会丢数据

当应用程序在写数据到硬盘时，先写入到内存缓存中，默认30S后会写入硬盘？

查看系统IO状态：#iostat -x 1 #查看1s内IO状态

内存快照： 创建快照时，将内存及磁盘中的数据都进行保存，速度慢，安全性高

一致性快照：创建快照时，CNA会通知tools将内存数据强制刷到硬盘中，再对硬盘数据进行快照，速度快，也不会丢失数据，如果还原快照，虚拟机是关机状态，不是开机状态。

就是Tools执行#sync命令。

COW：Copy on Write 写时复制。写前拷贝

下面是以前的老方法：

\#pvcreate /dev/sdb1 #将分区做成物理卷

 

![https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/B5B73B69B15D4327BDE432B7256D32B2/12860](./.图片存放/12860.png)

 

\#vgcreate vg0 /dev/sdb1 #创建物理卷组

 

![https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/FA1589326BC0499483FA7A7120999EC8/13032](./.图片存放/13032.png)

 

\#lvcreate -L 10G -n date vg0 #从vg0中分10G做逻辑卷date

 

![https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/1DF55DFA0F014BD59649E8FE03E1477A/13074](./.图片存放/13074.png)

 

\# mkfs.ext4 /dev/vg0/date #格式化卷组date为ext4格式

 

![https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/EA2E955C7AE8412F9381CF55F374C2A6/12863](./.图片存放/12863.png)

 

![https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/63AADAAB1E834B699436F000604DEE40/13065](./.图片存放/13065.png)

\#mount /dev/vg0/date /video #挂载到/video下

 

复制一些文件进去

 

![https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/5F39EB013A7043BE902667592995C929/12903](./.图片存放/12903.png)

 

\#dd if=/dev/zero of=/video/test1 bs=1M count=200 #创建两个文件

 

![https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/6F0FDA20E42741C3B3594DBCC5A86D3F/12929](https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/6F0FDA20E42741C3B3594DBCC5A86D3F/12929)

 

可以看到，真正的占用了这么多空间

 

![https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/269DC090F0DB41769D2E1372404828A0/12858](https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/269DC090F0DB41769D2E1372404828A0/12858)

 

可以看到，此时物理卷组vg0分配了10G空间出去

 

![https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/A6780FA2CBAD46D19E6CDA9EAFBB666F/12857](https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/A6780FA2CBAD46D19E6CDA9EAFBB666F/12857)

 

\# lvcreate -L 128M -s -n snap1 /dev/vg0/date #创建128M的快照空间，也就是COW空间，这个空间也是从vg0划分出来的

\#vgdisplay #查看物理卷组

 

![https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/3EEC544E22214B6E89517449CE13A515/12892](https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/3EEC544E22214B6E89517449CE13A515/12892)

 

[root@kvm-centos7 ~]# lvdisplay

--- Logical volume ---

LV Path         /dev/vg0/date

LV Name         date

VG Name         vg0

LV UUID         foCiKD-ojdb-0DcK-iCwP-uRoc-nH2Q-joObIE

LV Write Access     read/write

LV Creation host, time kvm-centos7, 2021-01-04 17:56:19 +0800

LV snapshot status   source of

snap1 [active]

LV Status        available

\# open         1

LV Size         10.00 GiB

Current LE       2560

Segments        1

Allocation       inherit

Read ahead sectors   auto

\- currently set to   8192

Block device      253:3

--- Logical volume ---

LV Path         /dev/vg0/snap1

LV Name         snap1

VG Name         vg0

LV UUID         eyPN50-B247-vGdR-eebm-AOTR-7rsR-7LTWPM

LV Write Access     read/write

LV Creation host, time kvm-centos7, 2021-01-04 18:19:57 +0800

LV snapshot status   active destination for date

LV Status        available

\# open         0

LV Size         10.00 GiB

Current LE       2560

COW-table size     128.00 MiB #COW空间

COW-table LE      32

Allocated to snapshot  0.01% #此次快照只用到了0.01%的空间

Snapshot chunk size   4.00 KiB

Segments        1

Allocation       inherit

Read ahead sectors   auto

\- currently set to   8192

Block device      253:6

\#mount /dev/vg0/snap1 /snap1/ #将snap1挂载

\#df -h #可以看到，刚才snap1使用了128M的0.01%，在这里依然显示使用了576M

 

![https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/F4E33D21903D490E8291CE5BF562770A/12884](https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/F4E33D21903D490E8291CE5BF562770A/12884)

 

\#ls #可以看到，这两个目录下的文件夹一致

 

![https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/39606075687F44289ABE292D46E10B90/12969](https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/39606075687F44289ABE292D46E10B90/12969)

 

\# rm -f /video/test1&&sync #删除/video下的test1并刷新数据到磁盘

\#ls /video #此目录下的test1没有了

\#ls /snap1 #此目录下的test1还在

 

![https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/FF75AD70DED84065A9AB4DE966E52519/12942](https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/FF75AD70DED84065A9AB4DE966E52519/12942)

 

\#df -h #可以看到，/video确实小了200M

 

![https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/E9EE9C9291804F90B362BC23D7E28132/12876](https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/E9EE9C9291804F90B362BC23D7E28132/12876)

 

\# dd if=/dev/zero of=/video/test3 bs=1M count=64 #新生成一个文件

此时COW里面已经没有test3文件了，他还是在/video文件夹下

 

![https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/2DDD84BA5D284C2BA9B3448076B87654/12907](https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/2DDD84BA5D284C2BA9B3448076B87654/12907)

 

\#lvdisplay #此时COW区域占用50%，这是刚才生成的tset3文件覆盖的数据块跑到COW这里来了，而不是覆盖文件跑到这里来，新的test3还是写在了/video，只是覆盖前的数据跑到COW了

 

![https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/0B06080EDF16427CA3C3B1C20C66725B/12893](https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/0B06080EDF16427CA3C3B1C20C66725B/12893)

 

一个文件有多个数据块，文件可以有很多指针，但是数据块只有一个指针

COW区域可以存放文件，但是一般给COW区域设置只读权限，不能写

此时删掉/video下的test2，重新生成一个128M的tset4，因为COW只有128M，所以COW坏了，lvdisplay查看此时COW的状态为 INACTIVE

 

![https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/BD755AEC5AC14305858131DF2D961380/12889](https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/BD755AEC5AC14305858131DF2D961380/12889)

 

系统已经将它卸载了，手动挂载也挂不上去了，这就是以前的老方法，不知道这个COW区域要设置多大才能保证COW不被损坏

 

![https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/81EC1E6E5F0742D6AD499B2288C0951E/12849](https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/81EC1E6E5F0742D6AD499B2288C0951E/12849)

 

如何保证COW不被破坏掉？

\#vim /etc/lvm/lvm.conf #lvm的配置文件

 

![https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/982E1B3B2DBD4D5DA7B00E4B56F9542D/12971](https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/982E1B3B2DBD4D5DA7B00E4B56F9542D/12971)

 

翻译：snapshot有个autoextend，它是用来自动扩展快照的，当snapshot_autoextend_threshold值为100时，即关闭自动扩展功能

 

![https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/0F3D044BF0294F29858F5D5D9A2DC052/12885](https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/0F3D044BF0294F29858F5D5D9A2DC052/12885)

 

翻译：当snapshot_autoextend_threshold值为70， snapshot_autoextend_percent 值为20时，意味着当snapshot大小达到总空间的70%时，自动扩展20%的空间。

snapshot_autoextend_threshold=100意味着不扩展

snapshot_autoextend_threshold不能低于50%

如果卷组的空间用不完，他就可以一直扩大

当做了快照之后，不删除数据，新写入的文件的数据块也会复制到COW区域。

从性能来讲，会影响写性能，但是对读性能没影响,不还原快照是不会读COW区域的。

新建快照之后，上一次快照创建的COW就变成只读了，新创建的快照又会生成新的COW。

还原快照后，快照还在，也就是拍快照前的数据的指针还在COW区域，所以快照可以拐弯。

索引是以块为单位的,删除COW快照和源卷没有关系，因为所有数据都是写在源卷的。

面试Q：做了快照之后，性能会有什么样的变化？

A：新能逐步回升。

现在的方法：COW和LUN共用一个存储，可以设置告警阈值，比如存储超过80%告警。

ROW：Redirect On Write 写时重定向

此时一个虚拟机在CNA01上运行，没有快照，到CNA01上查看配置文件

 

![https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/F05F1EF2D2EE449F90BC620D05C161DA/13116](https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/F05F1EF2D2EE449F90BC620D05C161DA/13116)

 

\# vim /etc/libvirt/qemu/i-0000003E.xml #编辑虚拟机配置文件

 

![https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/3997D5AF50674737B7E6B269D3041BB4/13022](https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/3997D5AF50674737B7E6B269D3041BB4/13022)

 

这就是虚拟机的磁盘目录，进入目录查看一下磁盘文件

 

![https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/B1E1D0D4235F4B77A311C7E32371ACAC/13057](https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/B1E1D0D4235F4B77A311C7E32371ACAC/13057)

 

\#ll -h /POME/datastore_5/vol/vol_b91d83b5-ccdb-40b0-bd6a-a1880088d1bb/vol_b91d83b5-ccdb-40b0-bd6a-a1880088d1bb.img #查看文件占用空间

 

![https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/4A364FD8D45D4AB79E2F0B9F519B0DF1/13011](https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/4A364FD8D45D4AB79E2F0B9F519B0DF1/13011)

 

此时，目录下只有这一个基础磁盘，啥都没干，创建个快照snap

 

![https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/57F98292D9A4455EBFD4AD09077EC067/13062](https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/57F98292D9A4455EBFD4AD09077EC067/13062)

 

再来查看磁盘目录，此时多了一个3M的文件，这就是这次创建快照的磁盘，即ROW区域

 

![https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/DD6C07E00F014D7F8A5C285D592BE290/12977](https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/DD6C07E00F014D7F8A5C285D592BE290/12977)

 

在虚拟机写入一些数据再来查看ROW区域的大小

模拟一个100M的数据

 

![https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/45B0B926AC8D449CA4B7426AB7980204/13044](https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/45B0B926AC8D449CA4B7426AB7980204/13044)

 

\# ll -h /POME/datastore_5/vol/vol_b91d83b5-ccdb-40b0-bd6a-a1880088d1bb/vol_857fed41-2cac-4d08-bfd0-05f60b89985d.img

\#此时ROW区域增加了100M的大小，因为ROW快照的数据都是写在ROW区域的

 

![https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/10562A591D9E4662BE65FC18B377237F/13060](https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/10562A591D9E4662BE65FC18B377237F/13060)

 

现在再次创建快照：snap2

 

![https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/8219C47347754824A415329C2D2CCBD3/12997](https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/8219C47347754824A415329C2D2CCBD3/12997)

 

再来查看磁盘目录，又新增一个ROW区域

 

![https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/EACD0C9935124F4AA99743E678C2B455/12965](https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/EACD0C9935124F4AA99743E678C2B455/12965)

 

继续模拟写入100M数据

 

![https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/A04D222DBBB44DEEB97896C8D69C7504/13052](https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/A04D222DBBB44DEEB97896C8D69C7504/13052)

 

数据写在了第二个快照中，基础磁盘和第一个ROW区域没有变化

 

![https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/C2880473FCFF46949A8D744DAEC4F9AD/12896](https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/C2880473FCFF46949A8D744DAEC4F9AD/12896)

 

若此时删除快照2，那么快照1的ROW会是什么样的变化？

 

![https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/27EB1AC36982441B9601E38A119F892A/13055](https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/27EB1AC36982441B9601E38A119F892A/13055)

 

![https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/EB0981B43D0644DD81A87AB27EA7D930/13028](https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/EB0981B43D0644DD81A87AB27EA7D930/13028)

 

此时，快照2会和快照1合并，如下图：磁盘只有两个了，但是快照1创建的ROW变大了，这就是快照2的ROW区域和快照1的ROW区域合并了，所以变大了。

 

![https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/EBE3AE3E4B4F46FC997AAFF340EA62CC/12991](https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/EBE3AE3E4B4F46FC997AAFF340EA62CC/12991)

 

因为只是删除快照，没有还原，所以创建快照2时创建的文件还在，没有删除

 



 

如果此时还原快照1，那么在创建快照1之后创建的数据全都没了，如下：

先还原快照1

 

![https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/FE9589DE8C96470CB7ABA2C49077AC8E/13050](https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/FE9589DE8C96470CB7ABA2C49077AC8E/13050)

 

恢复快照会关闭虚拟机，影响业务

 

![https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/D04672E7B41D459D8106339BED980200/13099](https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/D04672E7B41D459D8106339BED980200/13099)

 

还原之后，在这个快照创建之后的数据就没了

 

![https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/641464F4F24B4D46A4941153FF5E6183/13094](https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/641464F4F24B4D46A4941153FF5E6183/13094)

 

此时快照1创建的ROW中的数据也没了

 

![https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/6DBD0790F7EE467E927B37F7029BCBD4/13079](https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/6DBD0790F7EE467E927B37F7029BCBD4/13079)

 

从性能来讲，会影响读性能，但是对写性能没影响,不还原快照是不会丢数据的

NAS： 文件级共享

SAN:  块级别共享

NAS  非结构化数据  图像 视频 语音 文件 abd.doc  abc.wmv

NAS 大数据平台 ISO文件  松耦合

CIFS 两台windows之间互访，使用CIFS协议共享

NFS 两台Linux之间互访，使用NFS协议共享

NAS的文件系统在存储上

SAN的文件系统在业务主机上

**3.6.热迁移**

热插拔：取决于操作系统和虚拟化支持不支持

**3.6.1.虚拟机热迁移**

类似于ROW原理

前提条件：迁移的两台CNA都可以访问到同一台存储

开始迁移，内存生成一个内存位图区，类似于差分盘，内存位图区有个索引指向原来的内存在哪里，通过内存位图区记录原来的数据在哪里，新增的数据在哪里，新增的数据写在内存位图区中，旧的内存变成只读状态，将旧的内存迁移到另一台CNA，完成之后会阻塞上层业务下发，大概1s，在这期间将内存位图区迁移到另一台CNA。

内存双写：迁移的同时，在两台CNA的内存位图区同时写入新增的数据，旧数据迁移完成之后将数据合并之后，两台CNA的内存位图区将会释放。

迁移的同时，还会将虚拟机的配置文件一并迁移走。

热迁移条件限制：

不支持跨FusionStorage Block存储资源之间进行迁移

不支持已挂载“共享”类型的磁盘和连接克隆虚拟机的磁盘

不支持已挂载的总线类型为“IDE”的磁盘

跨集群迁移：同一套VRM管理的多个集群是可以使用同一套存储的。

不同VRM管理的集群不可以使用同一套存储，否则会触发存储的锁机制导致存储异常，不可用。

DRS HA只作用于一个集群、 手动迁移可以跨集群

跨集群热迁移前提条件：两个集群的配置要相同，不如一个开了内存复用，一个没开、 IMC模式要相同，CPU不兼容。

冷迁移没有这么多限制。

**3.6.2.存储热迁移**

热迁移首先使用写时重定向，将虚拟机数据写入目的存储的一个差异磁盘，这样，原磁盘文件就变成只读的。

将源卷的所有的数据块依次读取出来并合并到目标端的差异磁盘中，等数据合并完成后，目的端的差分磁盘就拥有虚拟磁盘的所有最新数据。

去除目的端快照对源卷的依赖，将差分磁盘修改为动态磁盘，这样，目的端磁盘文件可以独立运行。

**3.7.光纤交换机**

全球被博科垄断

WWNN:全球唯一节点号

WWPN：全球唯一端口号

接口数量、级联、长度都需要License

缺省管理IP：10.77.77.77 username：admin password:password

华为光交：所有接口都在一个ZONE里，默认全通

博科光交：所有接口都在一个ZONE里，默认全不同通

划分zone之前需要规划好，web和telnet都可配置，config只能同时激活一个，大zone,小zone

根据端口划分zone

优点：

缺点：不能随便插拔接口

根据WWPN号划分zone

优点：接口可随便插拔

缺点：第一次配需要一个一个找光纤卡的WWPN号，如果光纤卡坏了需要重新划分zone，未来维护很难

可使用alias别名标记接口的wwpn，创建zone时可使用别名创建，便于维护

 

博科交换机命令

 

查看

chassisshow #查看设备序列号

portshow

portstatsshow

portlogshow #查看各端口的工作状态

sfpshow #查看各端口上的模块

i #查看进程

 

时间

date #查看时间

date  0629231518 #更改时间为2018年6月29日 15:18

 

管理ip

ipaddrshow #查看ip地址

ipaddrset #更改ip地址

 

zone配置

alicreate  "Host01","wwpn号“    也可以写"1,1" #端口号：前面的数字代表Domain ID,后面的数字代表端口号

alicreate  "Host02","wwpn号“

alicreate  "storage01","WWPN号"

\#创建别名，端口的 wwpn号/端口号    ==>>    对应别名"Host01" 、"storage01"                     

*WWN：HBA卡的标识；WWPN：光模块端口的标识；WWNN：节点的标识

一般情况只会用到WWPN

 

zonecreate  "zone01","Host01;storage01"

zonecreate  "zone02","Host01;storage01"

\#创建zone，将别名加入zone

 

cfgcreate  "cfg01,"zone01,zone02"

\#创建配置文件cfg，将zone加入cfg

 

zoneshow #查看zone信息

cfgshow #查看配置信息

 

cfgenable  cfg01 #激活配置 cfg01

cfgsave #保存配置

 

cfgclear #清空所有配置

 

设置Domain ID

switchdisable #禁用交换机

configure #设置Domain ID

switchenable #激活交换机

 

switchshow

fabricshow #查看Domain ID

 

\## 级联配置

PS：

1、级联license（Fabric license）

2、主端和从端设备Domain ID不能相同

3、将从端cfg清空

 

连上光纤线，执行switchshow，端口显示E-port表示级联成功

此时主端zone和cfg会同步给从端

 

licenseshow #查看交换机所有license

 

\## 端口聚合

 

ISL Trunking

 

PS:

1、Trunking许可（Trunking license）

2、端口必须为E-port

3、端口配置必须一样

 

命令：

switchtrunk 1 #开启交换机Trunking功能

portcfgtrunkport  "端口号" #将端口加入Trunking

trunkshow #查看Trunking状态

 

switchtrunk 0 #关闭交换机Trunking功能

**3.8. QoS**

**计算QoS**

 

![https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/5294DBAF42684DA391AD7C5A13BDE475/12846](https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/5294DBAF42684DA391AD7C5A13BDE475/12846)

 

份额：高、中、低、自定义

预留：最低分配这么多，优先级最高

限制:最高分配这么多，

首先要满足预留值，还有资源空闲的情况下，根据份额比例来进行分配，但不得超过上限

存储QoS：设置磁盘I/O上限

衡量存储性能，一般有两个重要指标

（1）带宽  300MB/s  500MB/s  大文件 顺序大IO

（2）IOPS  Input/Output Per Sec IO 数量 随机小IO

网络QoS

发送，接受流量整形

**3.9.DRS规则**

互斥虚拟机

聚集虚拟机

虚拟机到主机

DRS：动态资源调度

DPM：动态电源管理

优先级顺序：电源管理---高级调度规则---负载均衡

**3.10. Tools**

安装并启动Tools后，用户无需做任何操作，Tools即可提供以下功能：

为虚拟机提供高性能的磁盘I/O和网络I/O功能

为虚拟机提供虚拟硬件监控功能

获取虚拟机指定网卡IP信息

获取虚拟机内部各CPU利用率、内存利用率

获取虚拟机内各个磁盘/分区的空间使用信息

为虚拟机提供高级功能

在线调整虚拟机的CPU规格

创建虚拟机快照

虚拟机蓝屏检测

虚拟机与主机时钟同步

虚拟机网卡的高级功能，如QoS

自动升级虚拟机的驱动程序，如Tools驱动

**3.11 . 安全组**

安全组是配置在虚拟机的网卡上的，默认拒绝所有进来的流量，相当于防火墙

ping协议：ICMP

**3.12 .VNC** 

VNC server 由虚拟机所在的宿主机提供    服务器端

VRM提供了VNCviewer  客户端

**网络虚拟化**

每个上行链路可以创建一台虚拟交换机、每台虚拟交换机可以由多条上行链路组成、一条上行链路只能属于一台虚拟交换机

![https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/5499C9744AC741DD972226D877EB51FE/13025](https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/5499C9744AC741DD972226D877EB51FE/13025)

 

![https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/5F3621799955450DBA359781A2AF798E/13107](https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/5F3621799955450DBA359781A2AF798E/13107)

 

![https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/4C8D9D358F514F2490DC668E38ADF98D/13145](https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/4C8D9D358F514F2490DC668E38ADF98D/13145)

 

**4.1.基础**

VLAN的划分：把接口加入到不同的VLAN、不同VLAN就是不同的广播域、vlan可以跨交换机创建。

不同VLAN直接广播隔离，不能互访通信

VLAN的优点

组网更加灵活，不受地域限制

隔离广播域，增强了网络安全性能

以太网帧的TAG，也称为802.1Q，其中PRI字段，3bit，称为8012.1p，用于QoS。

![https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/0A1BEED659DD4BDBAC990CFC53A2C86B/12848](https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/0A1BEED659DD4BDBAC990CFC53A2C86B/12848)

 

![https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/17ABFB10ED85478AA5839E3ECA5846C6/12990](https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/17ABFB10ED85478AA5839E3ECA5846C6/12990)

 

![https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/66DA4267876147A6BAC3D7C87D86CD5D/12844](https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/66DA4267876147A6BAC3D7C87D86CD5D/12844)

 

![https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/611FF33BDE644A2CA7939A28770FB0E8/12854](https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/611FF33BDE644A2CA7939A28770FB0E8/12854)

 

双网卡绑定：常用 0 1 4 6

 

![https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/61ED7BE57401489FB2734F16909DE291/12851](https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/61ED7BE57401489FB2734F16909DE291/12851)

 

![https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/A71602B404E448A5A8ECBE054F036ED0/12850](https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/A71602B404E448A5A8ECBE054F036ED0/12850)

如果是VRM物理部署，则没有默认的虚拟交换机和端口组

如果是VRM虚拟化部署，则默认会创建虚拟交换机和端口组，用于VRM自身用

SRIOV: Single Root IO Virtualization

SRIOV直通模式，需要网卡支持

优点： 减少中间内核开销，提升性能

缺点： 不支持虚拟机热迁移

**4.1.管理平面**

VRM连接CNA使用，访问VRM时使用，也用于心跳网络

**4.3.存储平面**

用于CNA主机连接存储的网络

**4.4.业务平面**

用于访问业务虚拟机的网络

端口组：

中继：可以选择多个vlan，一般用来嵌套，比如：虚拟机里面安装虚拟机

普通：只能选择一个vlan

DHCP隔离：端口组隔离DHCP请求

IP与MAC绑定：防止ARP欺骗，防止有人吧MAC地址更改

填充TCP校验和：需要TCP校验，会影响性能，但是可以保证数据的完整性。

发送，接受流量整形：即QoS

广播抑制：限制每秒发送的广播数量，防止广播报文攻击

**4.5.Vims心跳**

\1. 虚拟机热迁移流量

\2. 虚拟化SAN存储心跳流量管理

开了之后添加存储会失败。

![https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/99E9BF7B75144834B0DD647825AF0339/13010](https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/99E9BF7B75144834B0DD647825AF0339/13010)

**一、理论实验结合**

**1. 安装KVM环境**

此部分参考官方文档

 

，喜欢的可以参考官方文档，直接到第2章。

**1.1. 准备工作**

推荐使用ubuntu18.04安装到物理机上，centos也可以，本文就以ubuntu18.04和centos7.5为例说明搭建Fusion系列套件环境的方法。

首先准备工具:ubuntu18.04安装镜像，在http://mirrors.ustc.edu.cn/，下载安装镜像

喜欢用centos的也可以选择centos系统，这里使用centos7.5为例说明搭建KVM

阿里镜像源也可以下载到镜像：https://mirrors.aliyun.com/ubuntu-releases/18.04/ubuntu-18.04.5-desktop-amd64.iso﻿

![https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/CA5BC4FFC3254CBFBBF10951966305A9/12995](https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/CA5BC4FFC3254CBFBBF10951966305A9/12995)

8G U盘一个、性能强劲的一台计算机、软件Ventory,这是一款无需导入镜像即可启动的启动盘，只需将镜像拷贝进U盘，开机使用U盘启动，选择相应的镜像即可安装系统。

﻿https://www.ventoy.net/en/download.html 打开此链接，选择windows版本下载。

这是官方的蓝奏链接：https://www.lanzous.com/b01bd54gb#vtoy﻿

可以去这里下载，官网的是在github，速度有点慢。

 

![https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/2B8F2561B1C4410CBD96AE8EA8106C48/13063](https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/2B8F2561B1C4410CBD96AE8EA8106C48/13063)

 

 

![https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/CBC448B8FD10455BB56D3E3693968B0C/13128](https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/CBC448B8FD10455BB56D3E3693968B0C/13128)

 

解压之后，打开软件

 

![https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/440267A80B6347A3ADFF646C0A8425E2/13001](https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/440267A80B6347A3ADFF646C0A8425E2/13001)

 

选择相应的U盘，记得备份数据

 

![https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/15A7A40EAE814E41A7749B0B3EC6582D/13056](https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/15A7A40EAE814E41A7749B0B3EC6582D/13056)

 

现在就可以吧安装镜像拷贝到U盘了

 

![https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/5D4F328B007242E496D61A3DB5E3781A/13114](https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/5D4F328B007242E496D61A3DB5E3781A/13114)

 

开机使用U盘启动，选择相应的镜像，开始安装系统

 

![https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/EC1A297B70FB473FAF0777BCDE4C540D/12895](https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/EC1A297B70FB473FAF0777BCDE4C540D/12895)

 

rufus

官网：http://rufus.ie/ 其下载链接为github，速度慢

 

![https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/A66F75F5B67D42568A404EA08A14DEDE/12983](https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/A66F75F5B67D42568A404EA08A14DEDE/12983)

 

﻿https://306t.com/file/2880435-296150572 可以去这里下载

设置相关参数，点击“开始”

 

![https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/98727564960A481598F8AEA2DF096A3E/12950](https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/98727564960A481598F8AEA2DF096A3E/12950)

 

使用ISO镜像写入

 

![https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/7E494F970ECC48D8A7402370DC574B73/12948](https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/7E494F970ECC48D8A7402370DC574B73/12948)

 

进度条跑完即可安装系统

 

![https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/315AA366B82B4D409EFCFE695435C21E/13104](https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/315AA366B82B4D409EFCFE695435C21E/13104)

 

**1.1. 安装操作系统**

**1.1.1. 安装ubuntu18.04**

选择简体中文，开始安装ubuntu

 

![https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/ABD3AEA11B5F48FC903F9CAD797B1BD5/13054](https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/ABD3AEA11B5F48FC903F9CAD797B1BD5/13054)

 

点击继续

 

![https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/E86CEC27BC5242FEA8A142F160DF3270/13109](https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/E86CEC27BC5242FEA8A142F160DF3270/13109)

 

选择最小化安装

 

![https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/ED6824F1F0FC43C2BA4F9D60ABC2C50D/13088](https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/ED6824F1F0FC43C2BA4F9D60ABC2C50D/13088)

 

一般来说，如果你磁盘中有windows分区，这里会有一个选项是两个都存在，这里选择清除整个磁盘，按照自己的需求来，是双系统还是单系统，手动分区，如果想要自动分区，选择第一个即可。

 

![https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/4EE1E6C0ECC640449BBFD463228C02FF/13072](https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/4EE1E6C0ECC640449BBFD463228C02FF/13072)

 

选择继续

 

![https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/7362B677252B48A48237661283FA038B/13068](https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/7362B677252B48A48237661283FA038B/13068)

 

新建分区表

 

![https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/221C10E4FF194F7D83E30488372E05CB/13049](https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/221C10E4FF194F7D83E30488372E05CB/13049)

 

新建boot分区，给4096M，交换分区是内存的1.5~2倍。

 

![https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/29C5CE5B308745108D3362EBACA3425C/13002](https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/29C5CE5B308745108D3362EBACA3425C/13002)

 

剩下的给/即可。

 

![https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/0472C4C52F1C43C4BAB3B35C22CA81E9/13023](https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/0472C4C52F1C43C4BAB3B35C22CA81E9/13023)

 

点击“开始安装”

 

![https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/F71BDD4F80C14371AC410038BEE32394/13040](https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/F71BDD4F80C14371AC410038BEE32394/13040)

 

点击“继续”

 

![https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/01C5622307164778AF707152E7F0779B/12985](https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/01C5622307164778AF707152E7F0779B/12985)

 

时区选择上海

 

![https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/6CF92EC0E6F04FC0986C26C471A72FF7/12930](https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/6CF92EC0E6F04FC0986C26C471A72FF7/12930)

 

设置相应的参数

 

![https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/E1BFE1BFBD844E19B1F7666F7D2D39AD/13115](https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/E1BFE1BFBD844E19B1F7666F7D2D39AD/13115)

 

完成之后，点击“现在重启”

 

![https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/2E3580D65A644AA88AA94595E11B8988/13000](https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/2E3580D65A644AA88AA94595E11B8988/13000)

 

现在拔出U盘，按下回车键重启

 

![https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/F54F7A57CE52487E8B1448E893497F0A/13122](https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/F54F7A57CE52487E8B1448E893497F0A/13122)

 

重启之后，回车，输入密码进行登陆

 

![https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/E89A05A78FF94816B147F6BAE2688B34/12866](https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/E89A05A78FF94816B147F6BAE2688B34/12866)

 

一路前进

 

![https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/0A6AC1D5F6AE48DDB98CD61241F4BB0B/12978](https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/0A6AC1D5F6AE48DDB98CD61241F4BB0B/12978)

 

点击右上角，更换输入法

 

![https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/B81290D2916848878F37975E2760938C/13132](https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/B81290D2916848878F37975E2760938C/13132)

 

打开火狐浏览器，搜索ubuntu18.04的国内源

 

![https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/EC3CC16A58C54D76BD638872A2CF79B1/12934](https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/EC3CC16A58C54D76BD638872A2CF79B1/12934)

 

复制清华源

 

![https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/ABD61D95DE2B4085AE7A915DA7CF5247/12862](https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/ABD61D95DE2B4085AE7A915DA7CF5247/12862)

 

更换系统的镜像源，在桌面上右键，打开终端

 

![https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/A8ECABE9F5DC4DD98458045A1E4FA651/12877](https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/A8ECABE9F5DC4DD98458045A1E4FA651/12877)

 

\# $sudo vi /etc/apt/sources.list #编辑镜像源  输入密码开始编辑

使用dd 删除所有行，使用insert或者 i 进入编辑模式，使用shift+insert或者

ctrl+shift+v 粘贴刚才的镜像源，按下esc，推出编辑模式，按下“：” 输入wq!进行保存并退出

 

![https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/D2AA6DDE15E94BCA8D75EC97B2237806/12864](https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/D2AA6DDE15E94BCA8D75EC97B2237806/12864)

 

\##为什么要更换源？因为官方的速度是在太慢了。

$sudo passwd root #设置root密码  

 

![https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/02F3C8D3A68B42EAB39A6174059B94D5/13129](https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/02F3C8D3A68B42EAB39A6174059B94D5/13129)

 

$su - #切换到root用户

 

![https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/C3EE3536E52D417F84AC905DF9C69660/13174](https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/C3EE3536E52D417F84AC905DF9C69660/13174)

 

\#apt-get update && apt-get upgrade -y   #更新软件包  时间较长

 

![https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/6383C3835F944078BCCE7DFDEB45D2B6/12906](https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/6383C3835F944078BCCE7DFDEB45D2B6/12906)

 

\#reboot #重启服务器

 

![https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/83E8F49151C94504AFF656ED83EC18D4/13184](https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/83E8F49151C94504AFF656ED83EC18D4/13184)

 

\#apt-get install vim -y       #安装vim编辑器，个人比较喜欢

 

![https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/E1CB437FF7B54CEEA28230F5700A2A7B/12911](https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/E1CB437FF7B54CEEA28230F5700A2A7B/12911)

 

\#apt-get install net-tools -y #安装网卡查看工具，命令ifconfig

 

![https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/80098384537040CB96F4EC88611EDD30/12847](https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/80098384537040CB96F4EC88611EDD30/12847)

 

**1.1.2. 安装centos7.0**

点击“开启虚拟机”，开始安装虚拟机，然后回车

 

![https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/DD8CC8A3247D41DA9A8AF7F8174A83B1/13153](https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/DD8CC8A3247D41DA9A8AF7F8174A83B1/13153)

 

选择“中文”，点击“继续”

 

![https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/CF01F601E7384F068A3158FBB4F2B325/13075](https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/CF01F601E7384F068A3158FBB4F2B325/13075)

 

选择“语言支持”

 

![https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/DC777ED6B50F4C77B5EC1179E8CFAD1C/12989](https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/DC777ED6B50F4C77B5EC1179E8CFAD1C/12989)

 

选择“English”,并勾选相应的语言，点击“完成”

 

![https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/A53670A3EB8645459105CACE9008E8E8/12926](https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/A53670A3EB8645459105CACE9008E8E8/12926)

 

选择“安装位置”

 

![https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/DEC8E4AAB3A640D0A24FE5756459E562/13042](https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/DEC8E4AAB3A640D0A24FE5756459E562/13042)

 

点击“完成”

 

![https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/CB026C69BBE3462C83C51ADF02F8C91F/13009](https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/CB026C69BBE3462C83C51ADF02F8C91F/13009)

 

选择“软件选择”

 

![https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/704BA07F8D9C4B60858D7CDCEA303119/13038](https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/704BA07F8D9C4B60858D7CDCEA303119/13038)

 

选择“带GUI的服务器”单击“完成”

 

![https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/2D9910F8E1624C0FBB9E597CFA3083E0/12843](https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/2D9910F8E1624C0FBB9E597CFA3083E0/12843)

 

选择“KDUMP”，将其关闭，单击“完成”

 

![https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/79B148F3DD184CA2B35FE8CAE460A0B6/13071](https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/79B148F3DD184CA2B35FE8CAE460A0B6/13071)

 

![https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/29FAA2C8D17842438E1E75796CE8BF6F/12987](https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/29FAA2C8D17842438E1E75796CE8BF6F/12987)

 

选择“NETWORK”配置网络

 

![https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/301F0FC12F134D529E332343E5997514/13080](https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/301F0FC12F134D529E332343E5997514/13080)

 

将按钮设置为“开启”，设置主机名

 

![https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/22B18BBBCC244834817516C555497F3F/13019](https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/22B18BBBCC244834817516C555497F3F/13019)

 

点击“配置”将“可用时自动连接到这个网络”构上，点击“保存”，单击左上角的“完成”

 

![https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/5BA709A7E1EF401C8BE3E03157B759D0/13020](https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/5BA709A7E1EF401C8BE3E03157B759D0/13020)

 

点击“开始安装”

 

![https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/2A0620AC80F74A2FA91D7F333EFEBDA3/13048](https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/2A0620AC80F74A2FA91D7F333EFEBDA3/13048)

 

设置root密码

 

![https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/D618573785114D7FABA0297E7E24A144/13078](https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/D618573785114D7FABA0297E7E24A144/13078)

 

创建新用户

 

![https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/A5D214FD775C4529925891B23DDA1D55/13045](https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/A5D214FD775C4529925891B23DDA1D55/13045)

 

所以密码若提示“弱密码”，点击完成需要点击两次方可生效

等待进度条跑完，点击“重启”

 

![https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/DC63DF4CBF794413A0D4138A947F4127/13125](https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/DC63DF4CBF794413A0D4138A947F4127/13125)

 

点击“许可信息”

 

![https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/50E33B781AE449DFBA1A0F6112997D63/13141](https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/50E33B781AE449DFBA1A0F6112997D63/13141)

 

勾选“同意许可协议”

 

![https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/A12F94A7786649598A9A83B11FE83EB1/13172](https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/A12F94A7786649598A9A83B11FE83EB1/13172)

 

点击“完成配置”

 

![https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/37447FB27EBD475EB549D2AD4359FE62/13179](https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/37447FB27EBD475EB549D2AD4359FE62/13179)

 

进系统之后，使用root登陆

 

![https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/AA4080887D8A47C581E5E596EA302FBE/12939](https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/AA4080887D8A47C581E5E596EA302FBE/12939)

 

![https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/ED1A5168A10142C2902E23163362A625/12902](https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/ED1A5168A10142C2902E23163362A625/12902)

 

进去之后直接下一步下一步即可。

打开终端

 

![https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/67795007A01E40C3AD46D7A6F72F72B4/12921](https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/67795007A01E40C3AD46D7A6F72F72B4/12921)

 

\#vim /etc/hostname   #更改主机名

\#bash   #使得生效

 

![https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/1A651ED14EAE45FD8C70CBB9B3AAEBFD/13018](https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/1A651ED14EAE45FD8C70CBB9B3AAEBFD/13018)

 

**1.2. 安装配置KVM**

**1.2.1. ubuntu18.04**

命令：#apt-get install qemu qemu-kvm libvirt-bin bridge-utils virt-manager -y

\#安装KVM的软件包,完成之后重启计算机，使得安装的软件包生效。

 

![https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/99FF35C11DF542ABBF73EA595317655B/13021](https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/99FF35C11DF542ABBF73EA595317655B/13021)

 

将管理器固定到dock，便于使用，或者使用命令：#virt-manager 打开管理器

 

![https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/225F17D4BAC040F18FF53EB7EA80CD16/12859](https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/225F17D4BAC040F18FF53EB7EA80CD16/12859)

 

双击QEMU/KVM，打开连接详情，点击“网络接口”，点击“+” 新建一个网桥

 

![https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/6EA768E08EDC4E7DBA5B514A2CCC36C5/12957](https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/6EA768E08EDC4E7DBA5B514A2CCC36C5/12957)

 

设置参数

 

![https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/D686931009344B25AB5B1375D77687C4/12944](https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/D686931009344B25AB5B1375D77687C4/12944)

 

\## 有的是笔记本，这里的网卡名称可能不是ens3这种的，而是wlp2s0这样的名称，名称保持默认就好，启动模式选择onboot。

设置ipv4的参数

 

![https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/1889727A13ED4F359F9634CC6D4D0B4F/12946](https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/1889727A13ED4F359F9634CC6D4D0B4F/12946)

 

激活网桥

 

![https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/31019073E9A6497A8EE5332AEFCE9499/13082](https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/31019073E9A6497A8EE5332AEFCE9499/13082)

 

新建存储网络

 

![https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/A060E8B2AEC54A36B9D8B66E3BEB3E7E/13084](https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/A060E8B2AEC54A36B9D8B66E3BEB3E7E/13084)

 

设置相应的参数

 

![https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/960AEA00B70040B8B3199D351BA531F2/13034](https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/960AEA00B70040B8B3199D351BA531F2/13034)

使用隔离的网络

 

![https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/0E8B51181EF648DDBAE707B2A33B908A/13014](https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/0E8B51181EF648DDBAE707B2A33B908A/13014)

创建镜像目录和虚拟机磁盘目录

 

![https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/8313631AA21E40B29297D40497356912/12954](https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/8313631AA21E40B29297D40497356912/12954)

其中，iso存放安装镜像，fdisk存放虚拟机磁盘文件

 

![https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/4113F0F3EBFC45B1A6073190EC540C2B/13081](https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/4113F0F3EBFC45B1A6073190EC540C2B/13081)

 

在QEMU中添加这两个目录

 

![https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/DFCE16115B4E4CCC8B85B2C0B86F5B1B/12958](https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/DFCE16115B4E4CCC8B85B2C0B86F5B1B/12958)

 

选择目录路径

 

![https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/B7C15C55A58E4429AFFCBED2BC032A9C/13051](https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/B7C15C55A58E4429AFFCBED2BC032A9C/13051)

 

结果是这个样子

 

![https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/A2C5FA4046C644C086D4B22CBA3C43CC/13089](https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/A2C5FA4046C644C086D4B22CBA3C43CC/13089)

 

\##遇到的问题：网卡都是，提示有线或者无线未托管，使用下面方法解决

 

![https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/0FCCADEB8B624D969557C941C9890C27/13083](https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/0FCCADEB8B624D969557C941C9890C27/13083)

 

将这里改为 true ，然后重启Network-Manager

 

![https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/EF09ED6A02904B4E99E140900243C0DF/13147](https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/EF09ED6A02904B4E99E140900243C0DF/13147)

 

\#systemctl restart NetworkManager   #重启

即可看到网络正常

 

![https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/DA39B07D3C5745E6861A3285B22F18D0/12998](https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/DA39B07D3C5745E6861A3285B22F18D0/12998)

 

**1.2.2. centos7.0**

使用阿里yum仓库

\#wget -O /etc/yum.repos.d/CentOS-Base.repo http://mirrors.aliyun.com/repo/Centos-7.repo﻿

 

![https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/088D750920444082AE24CD92E64907F6/12908](https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/088D750920444082AE24CD92E64907F6/12908)

 

\#yum makecache #生成缓存

 

![https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/AE81096098E245DD88CF9C962BF67390/12888](https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/AE81096098E245DD88CF9C962BF67390/12888)

 

！！！重点 使用安装光盘配置yum仓库 ###重点

\#mount /dev/cdrom /media #挂载镜像

 

![https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/6E27123675FA41C0A796C65B8AAB7043/13013](https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/6E27123675FA41C0A796C65B8AAB7043/13013)

 

\#cd /etc/yum.repos.d

\#touch dvd.repo #名称可以随意，但后缀必须是.repo

\#vim dvd.repo

 

![https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/B0348C0546714BFAB6ADBFF4862E9C4F/12993](https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/B0348C0546714BFAB6ADBFF4862E9C4F/12993)

 

输入以下参数

[dvd] #仓库名，和文件名无关

name=centos #仓库描述，随便写

baseurl=file:///media #必须这么写

\#file://--url链接  /media--绝对路径

gpgcheck=0

 

![https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/12E5385A71AF4F7694D5082B62FE11CD/13118](https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/12E5385A71AF4F7694D5082B62FE11CD/13118)

 

移动所有文件到其他目录，只留dvd.repo，这里做了个备份

 

![https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/FF7CF95965D44321AE5DE4D697CD8E7A/12915](https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/FF7CF95965D44321AE5DE4D697CD8E7A/12915)

 

\#yum list all #查看系统中的所有包

\#yum groupinstall  “Virtualization” 

阿里yum仓库

 

![https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/D41713B1D7DC4328BA41A04411C44B11/12981](https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/D41713B1D7DC4328BA41A04411C44B11/12981)

 

本地yum仓库

 

![https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/EA5FBD693A1A44A7BAC2F8732DDC816A/12941](https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/EA5FBD693A1A44A7BAC2F8732DDC816A/12941)

 

输入“y” 确认安装

 

![https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/1391DE14D84145389DE34FB3F144873F/13077](https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/1391DE14D84145389DE34FB3F144873F/13077)

 

也可以使用：#yum groupinstall  “Virtualzation” -y安装kvm

安装完成之后重启计算机

配置网桥

\#cd /etc/sysconfig/network-scripts/ #进入网卡配置目录

\#cp ifcfg-eth0 ifcfg-br0 #复制网卡配置文件

\#vim ifcfg-br0 #编辑网卡配置

 

![https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/498A6A62DCC743BD9F48DB934672C53D/12883](https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/498A6A62DCC743BD9F48DB934672C53D/12883)

 

TYPE=Bridge

DEFROUTE=yes

NAME=br0

ONBOOT=yes

DEVICE=br0

IPADDR=192.168.100.1

NETMASK=255.255.255.0

GATEWAY=192.168.100.1

DNS1=192.168.100.1

DELAY=0

 

![https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/49B139CE6A42407EB3B481DE3A0C627C/12994](https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/49B139CE6A42407EB3B481DE3A0C627C/12994)

 

\#vim ifcfg-eth0

TYPE=Ethernet

DEFROUTE=yes

NAME=eth0

UUID=fe76b016-e8a6-461d-ae6e-0a7697899b6a

DEVICE=eth0

ONBOOT=yes

BRIDGE=br0

 

![https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/C36FC38381E7419AA52B444B516A7E15/13117](https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/C36FC38381E7419AA52B444B516A7E15/13117)

 

完成之后重启网卡,网桥即配置完成。也可以按照ubuntu18.04那样，使用图形界面创建网桥

\#service network restart #重启网卡

 

![https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/1958DA2A42FA4D559F494F599C986C2A/13112](https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/1958DA2A42FA4D559F494F599C986C2A/13112)

 

可以看到br0存在了

 

![https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/16B5FB2C2902440A9227A5D5BA664935/12919](https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/16B5FB2C2902440A9227A5D5BA664935/12919)

 

 

**1. FusionComputer**

gandalf默认密码：IaaS@OS-CLOUD9!

root默认密码：IaaS@OS-CLOUD8!

WEB登陆默认密码：IaaS@PORTAL-CLOUD8!

**1.1 搭建FusionComputer**

**1.1.1 KVM环境**

准备工具:FusionComputer_CNA_6.3.1.iso、FusionComputer_VRM_6.3.1.iso

打开控制台命令：hostconfig

新建虚拟机

 

![https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/117089B8ED38462E9B4D5CDC24581251/12904](https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/117089B8ED38462E9B4D5CDC24581251/12904)

 

设置参数，CPU=3，MEN>4096

 

![https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/60D806B9861E4BCC926B9BA15212D02C/12945](https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/60D806B9861E4BCC926B9BA15212D02C/12945)

 

新建磁盘

 

![https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/83EE4A6D24D24C20B994938DABAF2667/12927](https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/83EE4A6D24D24C20B994938DABAF2667/12927)

 

选择磁盘

 

![https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/7A747D229E24451C984D4C59ED82CFCB/12953](https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/7A747D229E24451C984D4C59ED82CFCB/12953)

 

选择“在安装前自定义配置”

 

![https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/03C04EC26FD44A82BF13A8AA909D2842/12917](https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/03C04EC26FD44A82BF13A8AA909D2842/12917)

 

这里如果选择VirtIO的话，会提升性能，但是后面扫描存储没有本地磁盘，

如果安装镜像想放在本地磁盘，这里的磁盘格式选择SATA即可。

 

![https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/54ADCB182CFE40B09151C0E0915A00CA/12905](https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/54ADCB182CFE40B09151C0E0915A00CA/12905)

 

然后添加3快网卡，前两个网络源选择br1，后两个选择storage,设备型号选择e1000

 

![https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/C6CBC01970CA4A2BA19CA0411F0798E4/12992](https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/C6CBC01970CA4A2BA19CA0411F0798E4/12992)

 

cpu型号设置为：host-passthrough, 这个要手动敲，意思是直通模式，将来安装的虚拟机cpu型号就和你本地物理机一样

 

![https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/FA7999859E964B678745970B3EC1745E/12996](https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/FA7999859E964B678745970B3EC1745E/12996)

 

点击“开始安装”

 

![https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/E487E29E8CE94F799ACFA48D162F89ED/12970](https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/E487E29E8CE94F799ACFA48D162F89ED/12970)

 

下面的步骤就和安装CNA一样了，这里不再展示

 

![https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/631BAEB9275D47D788CD449CD22B229C/13111](https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/631BAEB9275D47D788CD449CD22B229C/13111)

 

同样的方法安装CNA02和VRM，VRM的资源配置建议为：cpu=4，MEN>3072

所有组件安装完成，打开浏览器，输入VRM的管理地址，接下来需要手动创建集群，将CNA加入到集群中，创建端口组，创建存储。

**1.1.2 物理服务器**

准备工具：FusionComputer_CNA_6.3.1.iso、FusionComputer_VRM_6.3.1.zip、FusionComputer_Installer.zip

**1.1.2.1 配置RAID**

服务器开机，按照提示，使用”Ctrl+R”进入raid卡的bios

 

![https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/F69E5BD3609E454C8AB663284E46F44C/13017](https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/F69E5BD3609E454C8AB663284E46F44C/13017)

 

使用F2，来配置raid

 

![https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/26F377A41167432D9A1C227935D8CF9D/12886](https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/26F377A41167432D9A1C227935D8CF9D/12886)

 

第一个选择框来选择raid的级别，raid卡会自动根据磁盘数量现实可以配置的raid级别,有的raid卡之支持几种raid级别

 

![https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/AFE4BF08F8384A3EABAA63C17759B5C1/12874](https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/AFE4BF08F8384A3EABAA63C17759B5C1/12874)

 

选中磁盘，按下空格选中，VD Size会显示当前raid级别下磁盘可用空间

 

![https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/23967970E44C4A15909F8CFE9BEC7DE9/12873](https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/23967970E44C4A15909F8CFE9BEC7DE9/12873)

 

选择“OK”

 

![https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/913AFDD471AD46B0984A8B91D23AF96B/12891](https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/913AFDD471AD46B0984A8B91D23AF96B/12891)

 

此时可以看到，创建了一个Disk Group 0，raid级别是raid1，虚拟磁盘大小 278GB，有一块空闲磁盘

 

![https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/3A210AEAD5134E129315DFF0E18468A1/12868](https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/3A210AEAD5134E129315DFF0E18468A1/12868)

 

选中虚拟磁盘，按下“F2”，有开始初始化和快速初始化

 

![https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/96CEA46C3AC9472294AD036D1F4B7AFB/12865](https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/96CEA46C3AC9472294AD036D1F4B7AFB/12865)

 

这里选择“Fast Init”,选择“YES”

 

![https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/1D650FEFB30E406F9E271FB3F5918E6F/12881](https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/1D650FEFB30E406F9E271FB3F5918E6F/12881)

 

初始化完成

 

![https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/4293B9F8A5A44640B53B742BF466C77D/12875](https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/4293B9F8A5A44640B53B742BF466C77D/12875)

 

按“ESC”退出，选择“OK”

 

![https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/4030A5DE8A864ABB858162C2FA8B3875/12869](https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/4030A5DE8A864ABB858162C2FA8B3875/12869)

 

按”Ctrl+Alt+Del”重启服务器

 

![https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/A9BA325D81C946029C1505A0926D14AC/13176](https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/A9BA325D81C946029C1505A0926D14AC/13176)

 

![https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/3A50915FE8294929BFA91755F42B9DF3/13026](https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/3A50915FE8294929BFA91755F42B9DF3/13026)

 

**1.1.2.2 批量部署CNA**

服务器设置网卡启动，打开Installer安装工具

 

![https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/FB563E32E9034F9DA42D36B1A788E5C3/12909](https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/FB563E32E9034F9DA42D36B1A788E5C3/12909)

 

根据自己需要，选择相应的安装模式

典型安装：所有权限集中在一个管理员

自定义安装：三权分立，即有管理员，审计员，安全员

 

![https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/DF58033D1EEE40F5B591BC31E1B5997B/13006](https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/DF58033D1EEE40F5B591BC31E1B5997B/13006)

 

选择CNA安装包的位置，点击“开始检测”，软件会自动解压安装包

 

![https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/4D67898A2939418AA12B2CD99003E10A/12928](https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/4D67898A2939418AA12B2CD99003E10A/12928)

 

点击“下一步”

 

![https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/78C3B072A2BD45E2B3B0C8EDA7F9BB7E/12943](https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/78C3B072A2BD45E2B3B0C8EDA7F9BB7E/12943)

 

填写相应的信息，注意网络中一定要关闭其他DHCP服务器，否则会配置失败

 

![https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/3376964DB20B4D69A52B7C5F1032DDCE/12901](https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/3376964DB20B4D69A52B7C5F1032DDCE/12901)

 

服务器上电，设置网卡启动

 

![https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/6374C3099D924198B497BD923829F94C/12979](https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/6374C3099D924198B497BD923829F94C/12979)

 

![https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/BD11544ABA9A483994E5A24D0F66DE4F/12966](https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/BD11544ABA9A483994E5A24D0F66DE4F/12966)

 

此时一台服务器已经显示到这里

![https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/3BAB3542290146ADAC70CABF3CF49DAB/13181](https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/3BAB3542290146ADAC70CABF3CF49DAB/13181)

 

![https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/92C6A3346B4146EFBC1BC43396C66146/12962](https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/92C6A3346B4146EFBC1BC43396C66146/12962)

 

由于是实验环境，就以一台做演示，选择服务器，点击“开始安装”

![https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/4BFF72F5462B4FCB97A23BB53C7A5A81/12963](https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/4BFF72F5462B4FCB97A23BB53C7A5A81/12963)

 

此时在服务器上也可以看到状态

![https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/B0D5086B5C114AD98D579C15C5AC2084/13124](https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/B0D5086B5C114AD98D579C15C5AC2084/13124)

 

![https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/181AD3C47E8C40679B82BEDA5F0BE0DF/13120](https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/181AD3C47E8C40679B82BEDA5F0BE0DF/13120)

 

此时安装完成，点击“下一步”

![https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/2F13619680864E5AAA82BE4E8060B4A4/12980](https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/2F13619680864E5AAA82BE4E8060B4A4/12980)

 

点击确定

![https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/9F7F4B83981C4FD2BF2EBB451EBB69C3/13140](https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/9F7F4B83981C4FD2BF2EBB451EBB69C3/13140)

 

点击“完成”

![https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/D78EE95824F940BB810CCE558603EF14/13093](https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/D78EE95824F940BB810CCE558603EF14/13093)

 

点击“确定”

![https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/98AE65B5BEE4405496037CE038B39390/13119](https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/98AE65B5BEE4405496037CE038B39390/13119)

 

登陆测试

![https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/A3A913BDC8144FA0BD69E7D120AEE4C1/12923](https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/A3A913BDC8144FA0BD69E7D120AEE4C1/12923)

 

root密码:IaaS@OS-CLOUD8!

至此，批量安装CNA完毕。

**1.1.2.3 导入VRM**

登陆服务器IBMC口，设置光驱启动，点开控制台，挂载光驱

![https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/6B89547A5C9C4D4D9DDC80893547F952/13047](https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/6B89547A5C9C4D4D9DDC80893547F952/13047)

 

安装完成之后打开安装工具，选择安装VRM，下一步，将VRM.zip放置在Installer文件夹下

![https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/B0D2C852161B497C9C5225B87E8C0FEE/12914](https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/B0D2C852161B497C9C5225B87E8C0FEE/12914)

 

填写VRM的相关信息

![https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/3D1E1AE682AF41E1A32460D7B28E813E/12956](https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/3D1E1AE682AF41E1A32460D7B28E813E/12956)

 

填写CNA的相关信息，开始安装VRM

![https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/C37D0067CD9C41DB956724BC0ADBAA84/12982](https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/C37D0067CD9C41DB956724BC0ADBAA84/12982)

 

过程如下

![https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/1447FD4BF2E048688C5485860E644AD7/13182](https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/1447FD4BF2E048688C5485860E644AD7/13182)

 

![https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/AEC9C073D4AC4C01AB8A693032A7B187/13183](https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/AEC9C073D4AC4C01AB8A693032A7B187/13183)

 

![https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/D95E6DB9054C4CA5AD4E81E9F0796427/13173](https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/D95E6DB9054C4CA5AD4E81E9F0796427/13173)

 

![https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/EF369FF3F7CA4292AD15FE65B8686DEB/13163](https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/EF369FF3F7CA4292AD15FE65B8686DEB/13163)

 

![https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/2F8AD35A364945F5B8BBBAC651436A91/13160](https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/2F8AD35A364945F5B8BBBAC651436A91/13160)

 

![https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/294EF59A12564FEA8BDF30CE4E0F59C6/13168](https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/294EF59A12564FEA8BDF30CE4E0F59C6/13168)

 

![https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/88CCDB024C7244DE9F570FFB913F9717/13149](https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/88CCDB024C7244DE9F570FFB913F9717/13149)

 

![https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/936DED7FFFA14855B026AF23468063FE/13159](https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/936DED7FFFA14855B026AF23468063FE/13159)

 

![https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/5B22A1372813401487A33C5020F23BC8/13152](https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/5B22A1372813401487A33C5020F23BC8/13152)

 

![https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/A1FB32E35C334314A135401E88F5834F/13154](https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/A1FB32E35C334314A135401E88F5834F/13154)

 

![https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/00D411F3352D4BD7A70BC51AC747930E/13155](https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/00D411F3352D4BD7A70BC51AC747930E/13155)

 

![https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/260500A2226749B6B7ABA903F0981FB1/13169](https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/260500A2226749B6B7ABA903F0981FB1/13169)

 

![https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/4315AC3E3B8B4E53BFD6B8520414D69F/13157](https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/4315AC3E3B8B4E53BFD6B8520414D69F/13157)

 

![https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/6DB26946E5294A82BCFDFFD2A8A6C9C4/13156](https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/6DB26946E5294A82BCFDFFD2A8A6C9C4/13156)

打开VRM管理地址，更改默认密码，物理安装完成。

 

![https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/6F88831D6D614D13AB33502C391587E7/12880](https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/6F88831D6D614D13AB33502C391587E7/12880)

 

**1.2 存储多路径**

准备工具:VMwareworkstation 16、Server2012、CentOS7.0、WIndows和Linux主机多路径软件，estor仿真镜像

**1.2.1 安装estor存储仿真环境**

点击“创建虚拟机”

 

![https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/34D3B06C8C304E7F90876821196B29BC/13134](https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/34D3B06C8C304E7F90876821196B29BC/13134)

 

选择“自定义”，单击“下一步”

 

![https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/C5CD6724E59D4163B0648191C6530105/13097](https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/C5CD6724E59D4163B0648191C6530105/13097)

 

兼容性选择“Workstation 10.x”,单击“下一步”

 

![https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/1052273EA53446F99BA740984F6B52E7/13146](https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/1052273EA53446F99BA740984F6B52E7/13146)

 

选择“稍后安装操作系统”，单击“下一步”

 

![https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/382BF57DF3B44D3991AEB7459CB6CDD9/13143](https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/382BF57DF3B44D3991AEB7459CB6CDD9/13143)

 

选择“Linux”,版本选择“SUSE Linuxv Enterprise 11 64位”

 

![https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/4934411264404CBE87916EFC99FC9FED/13165](https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/4934411264404CBE87916EFC99FC9FED/13165)

 

自定义一个好听得名字，单击“下一步”

 

![https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/19815BF24B284BBFAB138ED805B31B58/13171](https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/19815BF24B284BBFAB138ED805B31B58/13171)

 

选择“BIOS”，单击“下一步”

 

![https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/E5C30FB2F7C24418B6C1E1E23C6A8C44/13175](https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/E5C30FB2F7C24418B6C1E1E23C6A8C44/13175)

 

选择1个处理器4核心，单击“下一步”，

！！！！！！！！！！！！！！！！！！！！！！！！我这里是用虚拟机演示，正常不会出现下面的警告

 

![https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/FE04554E954F4135970B7AD62532227C/13161](https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/FE04554E954F4135970B7AD62532227C/13161)

 

内存设置为 8192 ，单击“下一步”

 

![https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/2E98C9525CC043EB9BD4A4C14793FC11/13151](https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/2E98C9525CC043EB9BD4A4C14793FC11/13151)

 

网卡设置为“仅主机模式”，单击“下一步”

 

![https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/4EA1C97DD4DD468B86D7064F0BC89BC7/13133](https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/4EA1C97DD4DD468B86D7064F0BC89BC7/13133)

 

I/O控制器默认就好。单击“下一步”

 

![https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/89A4DCF8D9E74B7C8CA553B49ACD2862/13158](https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/89A4DCF8D9E74B7C8CA553B49ACD2862/13158)

 

磁盘类型选择“SCSI”，单击“下一步”

 

![https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/F36EA96C629C4A92ACD8D95422E612BE/13164](https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/F36EA96C629C4A92ACD8D95422E612BE/13164)

 

选择“现有磁盘”，单击“下一步”

 

![https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/B3198741C9034882A775E069DD81B49D/13135](https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/B3198741C9034882A775E069DD81B49D/13135)

 

单击“浏览”找到磁盘文件

 

![https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/03E4D7A7591544DBAC455C34C4848B27/13180](https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/03E4D7A7591544DBAC455C34C4848B27/13180)

 

此文件为网盘下载下来的压缩包解压得到的文件

 

![https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/B65BAA6CB8544527B0E4C951FE7365B9/13127](https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/B65BAA6CB8544527B0E4C951FE7365B9/13127)

 

选择此文件后，单击“下一步”

 

![https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/D02B35A8305A44F3A0E8FFD9DBB83FD1/13177](https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/D02B35A8305A44F3A0E8FFD9DBB83FD1/13177)

 

选择“保持现有格式”

 

![https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/39B62232C6824236BD3FFF26235DE183/13166](https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/39B62232C6824236BD3FFF26235DE183/13166)

 

选择“自定义硬件”

 

![https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/8D47110DEB674014934478A44F53F594/13148](https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/8D47110DEB674014934478A44F53F594/13148)

 

单击下面的“移除”，移除CD/DVD、声卡、打印机、USB控制器

 

![https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/666B3540EDE942D5BA06808EA5B0106F/13187](https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/666B3540EDE942D5BA06808EA5B0106F/13187)

 

![https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/3B441B3A5F0D47E68F85986CC0E13D69/13188](https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/3B441B3A5F0D47E68F85986CC0E13D69/13188)

 

![https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/6C945282BB0149B080086B537563D49F/13191](https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/6C945282BB0149B080086B537563D49F/13191)

 

![https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/BD47A358858E4F078BEEC95553BE7682/13190](https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/BD47A358858E4F078BEEC95553BE7682/13190)

 

![https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/B9EEE23B92FF46A3B0725C1FFDF0A169/13192](https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/B9EEE23B92FF46A3B0725C1FFDF0A169/13192)

 

单击下面的“添加”，额外添加5快网卡

 

![https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/7BCFD40BE55E461691F8CD504325267D/13144](https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/7BCFD40BE55E461691F8CD504325267D/13144)

 

将新加的网卡模式改成“仅主机模式”

 

![https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/AE1375131C96401A81C65BE75F1FE639/12984](https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/AE1375131C96401A81C65BE75F1FE639/12984)

 

单击下面的“关闭”

 

![https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/047102070983435F94A5DFFC5E727A47/13193](https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/047102070983435F94A5DFFC5E727A47/13193)

 

单击“完成”

 

![https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/15EE86A524F94194BF2C89D7FD476F71/13150](https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/15EE86A524F94194BF2C89D7FD476F71/13150)

 

选择“编辑虚拟机”

 

![https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/9C5CFC50BE974A39A9606077A2B598DC/13185](https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/9C5CFC50BE974A39A9606077A2B598DC/13185)

 

点击下面的“添加”，单击”下一步”

 

![https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/75BCA2DB3F894726A4489AC3406A8AC7/13008](https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/75BCA2DB3F894726A4489AC3406A8AC7/13008)

 

保持默认。单击“下一步”

 

![https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/A574BFEE81834FAFB77940A58C362409/13162](https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/A574BFEE81834FAFB77940A58C362409/13162)

 

保持默认。单击“下一步”

 

![https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/1DAAFD48D17E4E309C1EBACA852E8773/13139](https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/1DAAFD48D17E4E309C1EBACA852E8773/13139)

 

设置“340G”空间，将虚拟磁盘文件存储为单个文件，单击“下一步”

 

![https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/9AC2C9C4CB424EB0A8612E67CE1D9FA9/13131](https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/9AC2C9C4CB424EB0A8612E67CE1D9FA9/13131)

 

保持默认。单击“完成”

 

![https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/7A98DC43D80A4E5BB9CBAAD7BC476D56/13178](https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/7A98DC43D80A4E5BB9CBAAD7BC476D56/13178)

 

单击下面的“确定”

 

![https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/42F79C9422E84FA0AAF318DD2ACD5255/13189](https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/42F79C9422E84FA0AAF318DD2ACD5255/13189)

 

创建完成的虚拟机应该是这个样子的

 

![https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/C4FF3CFF15C44C3BAC99DA66F751D7B4/12972](https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/C4FF3CFF15C44C3BAC99DA66F751D7B4/12972)

 

点击“开启虚拟机”，开始安装虚拟机，根据自己环境设置相应的参数

 

![https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/4402ED84705F4CA2A64323C3C3F86E3B/12897](https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/4402ED84705F4CA2A64323C3C3F86E3B/12897)

 

输入用户名：admin 密码：Admin@storage  

！！！注意，是可能，不一定出现：如果CPU为AMD的，可能会出现这样的情况，此时输入：minisystem，然后出入exit，按 y 确定，此时会重启，等待一段时间之后重新输入用户名和密码即可

 

![https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/D962EB43293847EF89593F1F16954AD8/13095](https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/D962EB43293847EF89593F1F16954AD8/13095)

 

更改默认密码，输入的新密码可以等了WEB页面，到此仿真机就安装完成

 

![https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/F1177134CF1B4C96B111E3426274CDD6/12913](https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/F1177134CF1B4C96B111E3426274CDD6/12913)

 

**1.2.2 配置存储**

打开浏览器，输入estor_1配置的地址加上端口号8088，浏览器推荐火狐

 

![https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/6981C12780654289861047F16B357272/12894](https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/6981C12780654289861047F16B357272/12894)

 

![https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/DE71D17915414061A14552694B5EA311/13053](https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/DE71D17915414061A14552694B5EA311/13053)

 

关闭提示

 

![https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/EFB03B013D1442F2AF90C3ABCBAAB659/13007](https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/EFB03B013D1442F2AF90C3ABCBAAB659/13007)

 

选择“设置”，点击“基本信息”

![https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/5FFEEB45B25646839A2A06FA49C198B4/13110](https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/5FFEEB45B25646839A2A06FA49C198B4/13110)

 

修改时间

 

![https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/8804727480484A07AC8ADDFAE494140E/12947](https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/8804727480484A07AC8ADDFAE494140E/12947)

 

点击“确定”

 

![https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/12EA73A8BDA743639C83384274AFEFBD/13064](https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/12EA73A8BDA743639C83384274AFEFBD/13064)

 

查看首页信息得知，这个仿真环境为5000 序列号最后一位为5 导入的license必须和这两个参数相同，否则会报错

 

![https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/D2EF9B2189AF4494BC5C187C2542BA7F/13123](https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/D2EF9B2189AF4494BC5C187C2542BA7F/13123)

 

选择“设置”，点击“License管理”

 

![https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/78FA2AE94B1948AC9F596782B6B9D251/13041](https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/78FA2AE94B1948AC9F596782B6B9D251/13041)

 

![https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/59FF27306E5D4235AED3C6D44937044E/13086](https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/59FF27306E5D4235AED3C6D44937044E/13086)

 

选择相应的license并导入

 

![https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/DCFEA0DD0ABD4D5FA89838ABF2181828/13061](https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/DCFEA0DD0ABD4D5FA89838ABF2181828/13061)

 

导入成功

![https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/B238ABE2E7E247329C58F0F3D936C960/12933](https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/B238ABE2E7E247329C58F0F3D936C960/12933)

 

点击“激活”来激活license

![https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/E4B2AA3F9AAA41F191A7F91FA97B083B/13035](https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/E4B2AA3F9AAA41F191A7F91FA97B083B/13035)

 

此时，仿真机环境配置完成

![https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/020D8D5404E84B6C8E57C5FD4EFB3007/12937](https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/020D8D5404E84B6C8E57C5FD4EFB3007/12937)

 

选择“资源分配”，点击“创建硬盘域”，默认即可，点击“确定”

![https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/E4BBCDAAF189440385D4BE051A9B96EB/13031](https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/E4BBCDAAF189440385D4BE051A9B96EB/13031)

 

同样的位置创建存储池

![https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/BD4F44B939914729BA023BEA2C558903/13016](https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/BD4F44B939914729BA023BEA2C558903/13016)

 

创建LUN，不能多余5G，否则会报错

![https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/A0377AA69DAC4D828981DE3A28B7A8E0/12925](https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/A0377AA69DAC4D828981DE3A28B7A8E0/12925)

 

创建LUN组,将创建的LUN移到左边

![https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/E0E7DB2A71714B87A54CAF697B172D50/13059](https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/E0E7DB2A71714B87A54CAF697B172D50/13059)

 

创建主机

![https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/E1022911DE7843F29FA9DD25239CA3CD/13087](https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/E1022911DE7843F29FA9DD25239CA3CD/13087)

 

加入到主机祖

![https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/CF19B2572BAE4EE0959FD64CE64FD813/12973](https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/CF19B2572BAE4EE0959FD64CE64FD813/12973)

 

创建映射

![https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/3CDBEAE2E07041379ADB66EB98D8A82F/13004](https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/3CDBEAE2E07041379ADB66EB98D8A82F/13004)

 

到此就创建LUN，为Server2012和CentOS连接

选择“资源分配”，点击“端口”，为网卡添加IP

![https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/334921EDAD7E42629643E6436B0CA179/13098](https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/334921EDAD7E42629643E6436B0CA179/13098)

 

![https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/81FA4BE8A297422FBB16068978EE8415/13070](https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/81FA4BE8A297422FBB16068978EE8415/13070)

 

设置相应的ip

 

![https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/880E0B2AEF5E4105A7188057386737E7/13073](https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/880E0B2AEF5E4105A7188057386737E7/13073)

 

完成之后

 

![https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/23B53B06785D4BC59298449D471C2D25/13130](https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/23B53B06785D4BC59298449D471C2D25/13130)

**1.2.3 WIndows多路径**

打开Server 2012，搜索ISCSI，弹出下面这个，打开第一个

 

![https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/022B8727575F498A9B824242A06E6E94/13170](https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/022B8727575F498A9B824242A06E6E94/13170)

 

点击“是”

 

![https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/011B15710BA64BEAAC3A000F8474562E/13090](https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/011B15710BA64BEAAC3A000F8474562E/13090)

 

输入业务ip,点击“快速连接”，看到“已连接”之后点击“完成”即可

 

![https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/4359BDE206844C7796A45FB2901FD5CF/13005](https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/4359BDE206844C7796A45FB2901FD5CF/13005)

 

点击确定即可挂载存储

 

![https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/CE437676C3E5425984154EEEE5122598/13137](https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/CE437676C3E5425984154EEEE5122598/13137)

 

此时查看存储上主机的启动器即可看到连接成功

 

![https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/0687CCEE2A4A4D9EB66A219D6B17AEF0/13121](https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/0687CCEE2A4A4D9EB66A219D6B17AEF0/13121)

 

将启动器与主机关联

 

![https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/66909399CB9F431C8296AF87CF7A92EB/12999](https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/66909399CB9F431C8296AF87CF7A92EB/12999)

 

打开 运行 输入 diskmgmt.msc 打开磁盘管理，点击“操作”，选择“重新扫描磁盘”

![https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/7FE3605931DF4BD09E2A780ECDC49534/13024](https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/7FE3605931DF4BD09E2A780ECDC49534/13024)

 

即可看到新增的磁盘

 

![https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/B6D96FA5304F4475B889489431E125E3/12940](https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/B6D96FA5304F4475B889489431E125E3/12940)

 

新建磁盘分区，一直下一步就可以了

 

![https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/8330F223385B457388AB0C7DEEB52115/13003](https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/8330F223385B457388AB0C7DEEB52115/13003)

 

看到磁盘已经创建好，可以使用了

 

![https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/EC2C0B7A1DE048CBA10717627D810867/13167](https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/EC2C0B7A1DE048CBA10717627D810867/13167)

 

打开文件管理，即可看到新磁盘

 

![https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/752472E8CFE84EAF90F10326370A7FEA/13138](https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/752472E8CFE84EAF90F10326370A7FEA/13138)

 

连接两个IP地址

 

![https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/3DBB4691673E4EAA97F198CACD770809/13186](https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/3DBB4691673E4EAA97F198CACD770809/13186)

 

在存储上关联启动器

 

![https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/D1BE3DBE6B9C426AA7BD30CE540ECAEF/13085](https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/D1BE3DBE6B9C426AA7BD30CE540ECAEF/13085)

 

可以看到，有两快未配置的磁盘

 

![https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/1BB32FD2AA4F4BD59714F20CA6FE113F/12951](https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/1BB32FD2AA4F4BD59714F20CA6FE113F/12951)

 

安装WIndows主机多路径软件

 

![https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/85670EBEACB54C6EB30B3C339EC1A02A/13108](https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/85670EBEACB54C6EB30B3C339EC1A02A/13108)

 

![https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/CCE6DE74B12449579328466DF98CAFD3/13037](https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/CCE6DE74B12449579328466DF98CAFD3/13037)

 

![https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/8B04A40EE89646C093D9EF097BBB532C/13142](https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/8B04A40EE89646C093D9EF097BBB532C/13142)

 

重启之后即可看到只有一块磁盘

![https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/A5CA5D8E5EAD487BAC0A42E2294F3E5A/12936](https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/A5CA5D8E5EAD487BAC0A42E2294F3E5A/12936)

 

![https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/CE22022CEE604474A861DA2C0FF224E1/13076](https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/CE22022CEE604474A861DA2C0FF224E1/13076)

 

**1.2.4 Linux多路径**

主机多路径

![https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/21A71960CDC5494DB7109DE450316CD0/12959](https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/21A71960CDC5494DB7109DE450316CD0/12959)

 

如果两边都写，就会导致文件系统脑裂，数据不一致

集群控制主端能挂载，从端不会挂载，只有当主端故障时，从端才会接管

需要格式化成集群级文件系统（带锁机制），可以保证数据的一致性

同一个LUN不要同时共享给多台主机，除非他们是集群关系

存储端口设置不同的网段

![https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/C58BF96BCBBA4A3193C26250B5EE202E/13015](https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/C58BF96BCBBA4A3193C26250B5EE202E/13015)

 

这里以CentOS7.0为例进行展示，首先测试网络连通性

 

![https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/91DDA77DC9414FA38F09F16C34B41B87/12852](https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/91DDA77DC9414FA38F09F16C34B41B87/12852)

 

\#iscsiadm -m discovery -t st -p 172.16.201.20 #发起一个链接器

\#iscsiadm -m discovery -t st -p 172.16.202.20 #发起一个链接器

 

![https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/A4170C9330744D22A34F0E59FC3D82C0/12988](https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/A4170C9330744D22A34F0E59FC3D82C0/12988)

 

\#iscsiadm -m node -l #

 

![https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/EA5A63B1297240AEA5B6F52131E45FCE/12949](https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/EA5A63B1297240AEA5B6F52131E45FCE/12949)

 

在存储上，主机与启动器关联

 

![https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/BF9BE3498DBB4A908ECAF4489C9093C6/13058](https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/BF9BE3498DBB4A908ECAF4489C9093C6/13058)

 

\#lsblk #查看磁盘情况，可与看到，有两块5G的磁盘

 

![https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/C4B859E89B9148FA974EE22C14DFE7C4/12879](https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/C4B859E89B9148FA974EE22C14DFE7C4/12879)

 

SFTP上传RHEL多路径软件

 

![https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/9EC27D964F1643119F9E993C2938119D/13043](https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/9EC27D964F1643119F9E993C2938119D/13043)

 

\#unzip /home/yzh/OceanStor_UltraPath_21.5.0_RHEL.zip #解压

 

![https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/186E51EE37AB404A87EB4EF9848F5092/12845](https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/186E51EE37AB404A87EB4EF9848F5092/12845)

 

\# bash install.sh #开始安装

 

![https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/8EDA230B16FC4A28B9A741701446DDEA/12867](https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/8EDA230B16FC4A28B9A741701446DDEA/12867)

 

按“Y”重启系统

 

![https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/6A1E7ADAF04D4D519E43DC35F577C8CF/12878](https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/6A1E7ADAF04D4D519E43DC35F577C8CF/12878)

 

\#lsblk #此时看到只有一块磁盘了

 

![https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/0F116FDB18274D33A0FAEA6DF13DE692/12872](https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/0F116FDB18274D33A0FAEA6DF13DE692/12872)

 

\#upadmin show path #查看

 

![https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/FEBAD5C6E4FC40368B231D6017263E9F/12922](https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/FEBAD5C6E4FC40368B231D6017263E9F/12922)

 

\#upadmin show xxx   #查看xxx

\#fdisk /dev/sdb #对磁盘进行格式化

 

![https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/CD0A0EF2296A4E9CAE719DEA0A1E2112/12870](https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/CD0A0EF2296A4E9CAE719DEA0A1E2112/12870)

 

\#mkfs.ext4 /dev/sdb1 #格式化成ext4格式

 

![https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/A1700736A1784B19B8706C5AEE06F02B/12855](https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/A1700736A1784B19B8706C5AEE06F02B/12855)

 

\#mkdir /linux #创建挂载目录

\#mount /dev/sdb1 /linux #对磁盘进行挂载

\#lsblk #查看磁盘

 

![https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/B9F197D17D1B4C5C8E41BA8331C8FADD/12856](https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/B9F197D17D1B4C5C8E41BA8331C8FADD/12856)

 

**1.3 配置存储**

**1.3.1 SAN**

登陆FusionComputer，查看CNA的iqn号并记录

 

![https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/2526075A53964CB7B2BCDD47250442BD/13096](https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/2526075A53964CB7B2BCDD47250442BD/13096)

 

**2.2.1.1.centos系统**

创建一台centos7.5虚拟机，添加一块磁盘用来做SAN存储，配置好yum源，开始下面步骤。

\#lsblk #由于虚拟机是在kvm中安装，系统盘是virtual格式，所以这里可以看到系统盘是vda，新加的磁盘是sata格式，所以有一块100G的磁盘，sda

 

![https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/65CC853A17554E97A312701C53CD0FEF/12916](https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/65CC853A17554E97A312701C53CD0FEF/12916)

 

\#fdisk /dev/sda #注意磁盘名，可能是sdb

\#n #新建一个分区

\#p #创建一个主分区

\#1 #从第一个分区开始

\#回车 #默认从2048扇区开始

\#回车 #默认从最后的扇区结束

\#w #保存并退出

 

![https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/81B5A070B8A34EBB98C69AA5371AF7C2/12861](https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/81B5A070B8A34EBB98C69AA5371AF7C2/12861)

 

![https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/278CBE230C254525BE4995A18212BE91/13012](https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/278CBE230C254525BE4995A18212BE91/13012)

 

\#systemctl disable firewalld #开机不启动防火墙

\#systemctl stop firewalld #关闭防火墙

A方案：目前对接FC有问题

\#yum install targetcli -y #安装target服务

\#systemctl enable targetclid #开机自动启动

\#systemctl start targetclid #启动target服务

\#systemctl status targetclid #查看服务状态

 

![https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/55C5B4E4CD7E4F00BFD55FCFD713AB42/12918](https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/55C5B4E4CD7E4F00BFD55FCFD713AB42/12918)

 

\#targetcli #开始配置

/> /backstores/block create storage1 /dev/sda

\#给/dev/sda取一个别名storage1，分区必须存在，没有格式化，没有挂载

/> iscsi/ create iqn.2020-12.com.kvm-cent7:disk1

\#创建一个iqn，格式：iqn.xxxx-xx.com.xxx:xxx,真正的存储会自动创建

/> /iscsi/iqn.2020-12.com.kvm-cent7:disk1/tpg1/acls create iqn.2017-01.com.huawei:52:54:00:43:bb:ec-159

/> /iscsi/iqn.2020-12.com.kvm-cent7:disk1/tpg1/acls create iqn.2017-01.com.huawei:52:54:00:e8:2c:e2-160

\#为iqn设置cal规则，只让允许iqn连接存储，如果不设置就是所有设备都可以连接，如果有多个iqn就设置多次

/> /iscsi/iqn.2020-12.com.kvm-cent7:disk1/tpg1/luns create /backstores/block/storage1

\#将创建的iqn和storage1关联，后面服务端连接此iqn后会得到storage1这个设备

 

![https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/9228911853CB40B692E3CABEFD56F00B/12887](https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/9228911853CB40B692E3CABEFD56F00B/12887)

 

/>/iscsi/iqn.2020-12.com.kvm-cent7:disk1/tpg1/portals create 192.168.122.101

\#设置监听的地址，这个地址为kvm-centos用来做存储的地址

 

![https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/590B281109524535963532ADE5DFD9C3/13091](https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/590B281109524535963532ADE5DFD9C3/13091)

 

\#saveconfig

\#exit

 

![https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/737D25CB7CB945C1BBA15C4D766A5900/12960](https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/737D25CB7CB945C1BBA15C4D766A5900/12960)

 

B方案：可以对接FC

\#rpm -q epel-release #查看epel-release包是否安装

 

![https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/603D92A6F1104E61ABAA16D8EE6DF49C/13036](https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/603D92A6F1104E61ABAA16D8EE6DF49C/13036)

 

\#wget -O /etc/yum.repos.d/CentOS-Base.repo http://mirrors.aliyun.com/repo/Centos-7.repo #更换yum源为阿里的

\# yum install -y epel-release #安装epel-releasr包

 

![https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/BF99BFD7226140E7AECC09DBC7121AC5/12964](https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/BF99BFD7226140E7AECC09DBC7121AC5/12964)

 

\#yum install -y scsi-target-utils #安装scsi-target-utils

 

![https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/00C4F3692CE04B19A17F883A492F3303/12920](https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/00C4F3692CE04B19A17F883A492F3303/12920)

 

![https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/9451EEEED3E0418BB00F99A3C518E408/12882](https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/9451EEEED3E0418BB00F99A3C518E408/12882)

 

\#systemctl start tgtd.service && systemctl enable tgtd.service

\#systemctl disable firewalld && systemctl stop firewalld

 

![https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/19A8D265F14645958A7D209637BD4EFC/13067](https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/19A8D265F14645958A7D209637BD4EFC/13067)

 

\# vim /etc/tgt/targets.conf

在其行末添加以下内容

<target iqn.2020-12.com.yzh:fusioncomputer>  #iqn名字可任意

backing-store /dev/sda1         #刚才划分的分区

initiator-address 192.168.122.0/24  #限定 允许访问的客户端地址段或具体IP

</target>

 

![https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/9A59D8F0822D413C9207BED4D949A32A/12938](https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/9A59D8F0822D413C9207BED4D949A32A/12938)

 

\# systemctl restart tgtd.service #重启服务

\# systemctl status tgtd.service #查看服务状态

 

![https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/D26F4F4159244E00AEF2B24BFFEF2D50/12968](https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/D26F4F4159244E00AEF2B24BFFEF2D50/12968)

 

[root@kvm-centos7 ~]# tgt-admin --show

Target 1: iqn.2020-12.com.yzh:fusioncomputer

System information:

Driver: iscsi

State: ready

I_T nexus information:

LUN information:

LUN: 0

Type: controller

SCSI ID: IET   00010000

SCSI SN: beaf10

Size: 0 MB, Block size: 1  

Online: Yes

Removable media: No

Prevent removal: No

Readonly: No

SWP: No

Thin-provisioning: No

Backing store type: null

Backing store path: None

Backing store flags:

Account information:

ACL information:

192.168.122.0/24

**2.2.1.2.ubuntu系统**

创建一台ubuntu18.04虚拟机，配置好apt源，添加一块磁盘，开始下面步骤。

\#lsblk

 

![https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/9E01B509D95548E5BA5DB7AED354B7FE/12924](https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/9E01B509D95548E5BA5DB7AED354B7FE/12924)

 

\#fdisk /dev/sdb #注意磁盘名

\#n #新建一个分区

\#p #创建一个主分区

\#1 #从第一个分区开始

\#回车 #从默认扇区开始

\#回车 #从默认的扇区结束

\#w #保存并退出

 

![https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/7EBF0B54BE944F8E8EF57B205F076BC3/12890](https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/7EBF0B54BE944F8E8EF57B205F076BC3/12890)

 

\#lsblk

 

![https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/B7EC09483DB54BD7B388770540E69A96/12931](https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/B7EC09483DB54BD7B388770540E69A96/12931)

 

\#apt-get install -y tgt #安装服务

 

![https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/AF0700F3930841049C12DF2029CFCB69/12932](https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/AF0700F3930841049C12DF2029CFCB69/12932)

 

\# vim /etc/tgt/conf.d/fusioncomputer.conf #fusioncomputer.conf为此次创建的文件，可以自定义名称

 

![https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/97B7F3494CA849D4BE2D9C7913B3CD96/13136](https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/97B7F3494CA849D4BE2D9C7913B3CD96/13136)

 

<target iqn.202012.yzh.hcia.fusioncomputer> #自定义iqn的名称，格式要正确

backing-store /dev/sdb1   #刚才划分的分区

initiator-name  iqn.2017-01.com.huawei:52:54:00:43:bb:ec-159

initiator-name  iqn.2017-01.com.huawei:52:54:00:e8:2c:e2-160  #CNA的iqn，可以在web页面查询到

</target>

 

![https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/5F30FC11FE3345CB949F6E3220EF7667/13033](https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/5F30FC11FE3345CB949F6E3220EF7667/13033)

 

\# systemctl restart tgt #重启

\# systemctl enable tgt #开机自启

 

![https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/C4FED13C26F1488AAE7F7C78CC483C86/13066](https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/C4FED13C26F1488AAE7F7C78CC483C86/13066)

 

\#tgtadm --mode target --op show

root@kvm-ubuntu:~# tgtadm --mode target --op show

Target 1: iqn.202012.yzh.hcia.fusioncomputer

System information:

Driver: iscsi

State: ready

I_T nexus information:

LUN information:

LUN: 0

Type: controller

SCSI ID: IET   00010000

SCSI SN: beaf10

Size: 0 MB, Block size: 1

Online: Yes

Removable media: No

Prevent removal: No

Readonly: No

SWP: No

Thin-provisioning: No

Backing store type: null

Backing store path: None

Backing store flags:

LUN: 1

Type: disk

SCSI ID: IET   00010001

SCSI SN: beaf11

Size: 536871 MB, Block size: 512

Online: Yes

Removable media: No

Prevent removal: No

Readonly: No

SWP: No

Thin-provisioning: No

Backing store type: rdwr

Backing store path: /dev/sdb

Backing store flags:

Account information:

ACL information:

ALL

iqn.2017-01.com.huawei:52:54:00:43:bb:ec-159

iqn.2017-01.com.huawei:52:54:00:e8:2c:e2-160

root@kvm-ubuntu:~#

**1.3.2 NAS**

使用 #apt-get install nfs-kernel-server -y #安装nfs服务

 

![https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/4CAC4D2B79784FE4ACB42831ADCA4077/12967](https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/4CAC4D2B79784FE4ACB42831ADCA4077/12967)

 

\#mkdir -p /home/yzh/nfs #新建共享目录

 

![https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/8D2F96CD2A99471CAE61FECFAEA5E5A4/13102](https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/8D2F96CD2A99471CAE61FECFAEA5E5A4/13102)

 

\#vim /etc/exports   #编辑文件

在末行添加下面的参数

/home/yzh/nfs *(rw,sync,no_subtree_check,no_root_squash)

 

![https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/0207AAB8DDF14534B4D0EB3FB1D9F135/12986](https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/0207AAB8DDF14534B4D0EB3FB1D9F135/12986)

 

重启nfs服务并加入开机启动项

\#systemctl start nfs-kernel-server.service

\#systemctl enable nfs-kernel-server.service

 

![https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/F7372CB357F14944958D46ACC808A54C/12975](https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/F7372CB357F14944958D46ACC808A54C/12975)

 

然后在FusionComputer对接存储，选择NAS存储，填写IP地址对接。

**1.3.3 对接存储**

登陆FC，点击“存储”

 

![https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/94B47D79118A404A9D107DF2EB8C48F1/13195](https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/94B47D79118A404A9D107DF2EB8C48F1/13195)

 

点击“存储资源”，选择**IP SAN**，填写相应的信息，勾选“关联主机”，单击“确定”

 

![https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/39F4771E36DE4F90B4A5A8E39E96854B/13197](https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/39F4771E36DE4F90B4A5A8E39E96854B/13197)

 

\#重要的是存储IP，一定要填对

选择“集群”，点击“确定”

 

![https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/DB5534E8F76C4752BBCECA44EF3DAC1A/13199](https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/DB5534E8F76C4752BBCECA44EF3DAC1A/13199)

 

**添加NAS存储**

 

![https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/F94CBB7A004346618B22FC0F8713963C/13201](https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/F94CBB7A004346618B22FC0F8713963C/13201)

 

添加完成

 

![https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/3795FE3F4DC64EB38F603DAB37E33482/13203](https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/3795FE3F4DC64EB38F603DAB37E33482/13203)

 

扫描存储设备

 

![https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/A0BBEC2D65CD4B2BA1A83B3539039334/13205](https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/A0BBEC2D65CD4B2BA1A83B3539039334/13205)

 

扫描结果

 

![https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/F1382A7E23794F9BBED43B3698C3EC20/13207](https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/F1382A7E23794F9BBED43B3698C3EC20/13207)

 

**添加IP SAN数据存储**

 

![https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/CC42193C44C94067AD3640A9E0B57A54/13210](https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/CC42193C44C94067AD3640A9E0B57A54/13210)

 

根据存储类型选择相应的使用方式

 

![https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/EA7CF189616E4CEAA076175181AD2F97/13212](https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/EA7CF189616E4CEAA076175181AD2F97/13212)

 

\#底层正在吧SAN存储映射的LUN格式化成集群级文件系统并挂载，只需格式化一边即可

华为的集群级文件系统：VIMS   Virtual Image File System

本质为：ocfs2  (oracle file system V2)  oracle集群级文件系统

VMware集群级文件系统：VMFS5

锁机制:维护文件系统的一致性

锁类型：文件级锁、数据库级字段锁

**添加NAS数据存储**

 

![https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/97FFE13E20184E0583257084509A8A2E/13214](https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/97FFE13E20184E0583257084509A8A2E/13214)

 

**添加本地存储**

 

![https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/34EF368152284CD9A31E6A3C7488C3E7/13216](https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/34EF368152284CD9A31E6A3C7488C3E7/13216)

 

至此，所有存储添加完成

 

![https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/1D98A9472099449B8D2F316B6EAA9CDF/13218](https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/1D98A9472099449B8D2F316B6EAA9CDF/13218)

 

**1.4 安装系统**

准备工具:jre-windows-x64.exe

创建虚拟机，参数根据环境填写

 

![https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/7C25A8B189AE4644B80A89C440064FE3/13220](https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/7C25A8B189AE4644B80A89C440064FE3/13220)

 

创建完成会自动开机

 

![https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/1601588D66E9496D856F14BB1943AE64/13222](https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/1601588D66E9496D856F14BB1943AE64/13222)

 

有三种方式挂载镜像，挂载本地镜像，需要安装jre环境以及FusionComputer插件

 

![https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/071F5CA9779F4DD89EE12E49D7AAE3E9/13224](https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/071F5CA9779F4DD89EE12E49D7AAE3E9/13224)

 

安装这个插件

 

![https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/EE29B9613B4E4503BCFD05071A27B5B2/13226](https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/EE29B9613B4E4503BCFD05071A27B5B2/13226)

 

此时就可以挂载镜像

 

![https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/B2B501D6EC1540E798CD3B586D68A7F8/13228](https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/B2B501D6EC1540E798CD3B586D68A7F8/13228)

 

使用文件方式，需要上传镜像文件到FC的存储里面，这里上传镜像到SAN存储上面

 

![https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/2B991C9CA18C4E48896E52368CE2016E/13230](https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/2B991C9CA18C4E48896E52368CE2016E/13230)

 

挂载镜像

 

![https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/F3EF3D0496A94C1D80520B21F85EE504/13232](https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/F3EF3D0496A94C1D80520B21F85EE504/13232)

 

修改启动方式为光驱

 

![https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/C30F43B701EA498192D41A8B7112BF56/13234](https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/C30F43B701EA498192D41A8B7112BF56/13234)

 

强制重启虚拟机

 

![https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/C48004A78D7946A7B7C91B5B66F3F566/13236](https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/C48004A78D7946A7B7C91B5B66F3F566/13236)

 

使用VNC登陆

 

![https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/9995851423EC4274A90EAC5ADCE30CD4/13238](https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/9995851423EC4274A90EAC5ADCE30CD4/13238)

 

开始安装操作系统

 

![https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/EF56FB460E97420389BB6B2BC79A3912/13242](https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/EF56FB460E97420389BB6B2BC79A3912/13242)

 

点击“现在安装”

 

![https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/143FE44543B746B8BDCCAC15F7C11DCA/13241](https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/143FE44543B746B8BDCCAC15F7C11DCA/13241)

 

输入激活码，点击“下一步” TVNTG-VFJQ3-FQXFP-DVCP6-D3VJ8

 

![https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/BF63A97671F84DD69E959F22BCF462B9/13244](https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/BF63A97671F84DD69E959F22BCF462B9/13244)

 

选择带GUI的服务器，点击“下一步”

 

![https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/B7DC2D316BC1476CA7126E3F9A3F65A3/13246](https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/B7DC2D316BC1476CA7126E3F9A3F65A3/13246)

 

选择“接受许可条款”，单击“下一步”

 

![https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/B1F47E8525CD4DFC8506BC1F9D490374/13248](https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/B1F47E8525CD4DFC8506BC1F9D490374/13248)

 

选择“自定义安装”

 

![https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/59A2BE0C431E401CB828E25D6B1092C3/13250](https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/59A2BE0C431E401CB828E25D6B1092C3/13250)

 

点击“加载驱动程序” #WIndows安装时需要加载Virto驱动，否则找不到磁盘

 

![https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/B577BAACD28146DFB68F33671E7EE43B/13252](https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/B577BAACD28146DFB68F33671E7EE43B/13252)

 

单击“下一步”开始安装

 

![https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/0F90CADACB39423C94AC3C859F1B9A44/13254](https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/0F90CADACB39423C94AC3C859F1B9A44/13254)

 

等待完成会自动重启

 

![https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/761AD3FCA9CE491F9572BE6769AF6A45/13256](https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/761AD3FCA9CE491F9572BE6769AF6A45/13256)

 

开机之后，设置密码，要符合复杂度要求，包含数字，字母，符号，单击“完成”

 

![https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/B1FB6E89288545D7A836A6B5298C56F5/13258](https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/B1FB6E89288545D7A836A6B5298C56F5/13258)

 

点击右上角的“ctrl+alt+delete”，输入密码，然后回车即可进入系统

 

![https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/22BFAAEDBAC8451A8A8E0BBD96AC754C/13260](https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/22BFAAEDBAC8451A8A8E0BBD96AC754C/13260)

 

**1.5 挂载Tools**

准备工具:CentOS系统安装镜像

**1.5.1 Windows**

挂载Tools

 

![https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/F58B2861351F4A0D878A99644F1574DB/13262](https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/F58B2861351F4A0D878A99644F1574DB/13262)

 

此时就可以正常安装Tools

 

![https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/B923F4050C2A46D58447A4D0C286AFA3/13264](https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/B923F4050C2A46D58447A4D0C286AFA3/13264)

 

重启即可

 

![https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/C5ED333135804F7EB9F81D7E17B4514A/13266](https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/C5ED333135804F7EB9F81D7E17B4514A/13266)

 

**1.5.2 Linux**

现在linux基本都是最小化安装，没有图形界面，安装tools需要命令行安装，这里就以红帽系”最小化安装”演示linux系统安装华为Tools的步骤

可以看到，最小化安装的centos，没有安装tools，没有获取到ip地址，使用ssh连接虚拟机，开始操作，如果没有ip，可以在在vnc界面操作，就是有点难受，自己决定。

 

![https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/42E1B0ABC5824EE59B839FFAA6160B52/13268](https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/42E1B0ABC5824EE59B839FFAA6160B52/13268)

 

没有在vrm界面安装光驱，手动安装之后在来看

 

![https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/54CB840A9C8F420091288F28B083F425/13270](https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/54CB840A9C8F420091288F28B083F425/13270)

 

现在在来看

 

![https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/5B0C6CB8214D46348A7829B17D186DEB/13272](https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/5B0C6CB8214D46348A7829B17D186DEB/13272)

 

有东西了，开始挂载镜像

\#mount /dev/cdrom /media #挂载cdrom到/media 挂载点

\# rpm -ivh /media/Packages/gzip-1.5-7.el7.x86_64.rpm #安装gzip包

\##此包也可不装，这里安装保险一点

 

![https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/C179CCE6CF85479F9A114AB1D485F613/13274](https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/C179CCE6CF85479F9A114AB1D485F613/13274)

 

\#rpm -ivh /media/Packages/bzip2-1.0.6-12.el7.x86_64.rpm #安装bzip2包

 

![https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/345E3497E37B4BF2A9B8F33C4AFB5496/13276](https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/345E3497E37B4BF2A9B8F33C4AFB5496/13276)

 

\#umount /dev/cdrom #卸载

 

![https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/C68785E5FA164D7BA81937ADA38558BB/13278](https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/C68785E5FA164D7BA81937ADA38558BB/13278)

 

此时，在vrm界面卸载光驱，点击挂载tools

\#mount /dev/cdrom /media/ #挂载cdrom到/media

\#mkdir -p /home/tools #新建文件夹，也可不建

\#cp /media/vmtools-2.5.0.142.tar.bz2 /home/tools/ #复制tools到系统

 

![https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/52E2EE85D636405BB85FD84638E7AFF8/13280](./.图片存放/13280.png)

 

\#tar -jxvf /home/tools/vmtools-2.5.0.142.tar.bz2 #解压tools包

\#cd /home/tools/vmtools #切换到解压的目录

\#./install #安装

\#reboot #重启

 

![https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/2AB7D7A62123449ABB7EB53610B8EE4C/13282](./.图片存放/13282.png)

 

此时tools安装成功，获取到ip地址

 

![https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/2D213833926644F89E9E11F47B8D1080/13284](./.图片存放/13284.png)

 

硬件信息也成功获取

 

![https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/8D2F60EF905A4797AEE3029430D6C23C/13286](https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/8D2F60EF905A4797AEE3029430D6C23C/13286)

 

**1.6 制作模板**

**1.6.1 Windows**

此处以Server2012为例

运行>sysprep

 

<img src="./.图片存放/13288.png" alt="https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/5DEBE4A37549440F8E5B43995F5CEBF9/13288"  />

 

以管理员身份运行

 

![https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/E251D7F040804BAF869F6AA549B62436/13290](./.图片存放/13290.png)

 

勾选>通用，关机选项选择>关机。然后确定

 

![https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/B37A26F2BCB64D36B184398E09C57C60/13292](./.图片存放/13292.png)

 

完成之后会自动关机

 

![https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/CA96C53C42D6416AA7FFA751355219EA/13295](./.图片存放/13295.png)

 

在虚拟机概要里面，选择更多操作>模板>转换为模板或者克隆为模板。这里选择转换

 

![https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/09AA8D9D826647DEB70E35871058771A/13296](./.图片存放/13296.png)

确定即可

 

![https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/BF570458C10F47A39304BDBADC16AE18/13298](./.图片存放/13298.png)

 

此时即可在虚拟机模板看到模板

 

![https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/3A0AACFF44AF4C2987F1DE42A752F15D/13300](./.图片存放/13300.png)

 

**1.6.2 Linux**

A:使用sys-unconfig封装

\# vim /etc/sysconfig/network-scripts/ifcfg-eth0

注释 MAC地址，UUID，打开DHCP

 

![https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/689FBAC5AA194184B1D6F8E9EE84C23E/13302](./.图片存放/13302.png)

 \# vim /etc/hostname

修改主机名为：localhost.localdomain

![https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/0248E584E7DA465C9D7EE46F9F404E88/13304](./.图片存放/13304.png)

 \#rm -rf /etc/ssh/ssh_host_*

删除ssh密钥，注意不要删错吧配置文件删了，重启sshd服务或者关机开机之后会重新生成随机的ssh密钥。

![https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/00C26CB28F0641FE8E956B1BAA695D95/13306](./.图片存放/13306.png)

\#sys-unconfig #类似windows的 sysprep

将虚拟机转换为模板即可

B:手动封装

[root@localhost ~]# touch /.unconfig gured

[root@localhost ~]# rm -rf /etc/ssh/ssh_host_*

[root@localhost ~]# vim /etc/sysconfig/network-scripts/ifcfg-eth0

[root@localhost ~]# rm -rf /etc/udev/rules.d/70_*

[root@localhost ~]# rm -rf /var/log/*

[root@localhost ~]# hostname

localhost.localdomain

[root@localhost ~]# poweroff

![https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/1073C07D6A64441AA4B0ACD2380871D8/13309](./.图片存放/13309.png)

将虚拟机转换为模板即可

**1.7 备份VRM**

自动备份目录：/var/backup

手动备份目录：/var/backup/manual

配置FTP服务，备份VRM配置信息

CentOS

[root@SAN ~]# yum install -y vsftpd

[root@SAN ~]# systemctl start vsftpd

[root@SAN ~]# systemctl enable vsftpd

 

![https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/DA3D2B09C27645F99678348FD5CB287F/13311](./.图片存放/13311.png)

 

![https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/62AD4C0B3F6542619C9BF6B44FE2EED9/13313](./.图片存放/13313.png)

 

这种备份方式为linux中的定时任务，其配置文件可以在下面的目录进行修改

grep -ir ‘0 2’ /etc：根据内容搜索文件

VRM:~ # vim /etc/crontab #VRM中所有的定时任务配置文件

 

![https://note.youdao.com/yws/public/resource/c6dc229388284e32e9997ec0cf984dbe/xmlnote/BA2F433C226F4D2095958074F23FB918/3DCD5DFBDB1D4071A4C385B1D0B8E6E9/13315](./.图片存放/13315.png)

 

脚本位置：/opt/galax/ge_backup/bin/cronBackupUpload

**1.8 存储解关联失败解决方案**

```
存储与主机的关联异常中断，在卷被删除后，数据库中残留存储的数据未成功删除，导致无法在FusionCompute系统中删除对应数据存储信息。
解决方案： 
使用PuTTY登录VRM主节点。
 通过浮动IP地址，使用gandalf帐号登录，并切换至root帐号。
 执行以下命令，登录VRM数据库。
    #psql -U galax vrm
默认密码为“SingleLOUD!1”。
执行以下命令，查询该数据存储的ds_index信息。
   select ds_index from tbl_vs_datastore where ds_name='数据存储名称';
#不能上翻键调出，错误只能重新输入
其中数据存储名称为FusionCompute系统中对应数据存储的名称，查询到的回显信息示例如下：
根据查询到的ds_index信息，执行以下命令查询其tbl_vs_volume数据表中的卷状态。
    select vol_id,vol_status,ds_index from tbl_vs_volume where ds_index=ID;
#不能上翻键调出，错误只能重新输入,输入错误可使用“ctrl+删除”删除输入的错误
    其中ID为步骤 3查询到的ds_index取值。
    回显信息如下图所示：
查看该存储内文件信息：VRM=》select * from tbl_vs_file;
删除该磁盘内所有文件：VRM=》delete from tbl_vs_volume where ds_index=4;
在FC页面中解关联或消除该数据存储。
```

 

```
根因:
删除数据存储时，应遵循：先在FC中解关联或销毁数据存储，再在存储中接触映射，删除lun的操作顺序。
先删除存储中的lun将导致VRM报错，不能正常解关联或销毁数据存储
解决方案：
  在VRM数据库中删除对应数据存储信息，再解关联对应数据存储
```

**1.9 VRM admin密码忘记修改**

```
1. 登录vrm节点 主备环境使用浮动ip登录， 先使用gandalf登录后切换为root
“gandalf”用户的默认密码为“IaaS@OS-CLOUD9!”，“root”用户的默认密码为“IaaS@OS-CLOUD8!”
2、登录数据库 ;
       psql -U galax -W 'SingleLOUD!1'  vrm; (注：SingleLOUD!1为默认密码)
3、还原admin 密码； 默认：IaaS @PORTAL-CLOUD8!
     update sm.tbl_user set password='ed1a53af6f94d460ae36d39157e84d8bw+MJmGLcUz02' where user_id='7026';
4、 重启vrm服务； 
     service vrmd restart；
5、服务重启完成后使用默认密码登录。
```

 

 